<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NGN ëŒ€ì‹œë³´ë“œ</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <!-- âœ… ApexCharts ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.css">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
  <!-- âœ… ECharts ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=1.5">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/monthly_report.css') }}?v=1.0">

  <script>
    var userCompanyList = {{ session['company_names'] | tojson }};
    var currentUserId = "{{ session['user_id'] }}";
  </script>
  <script src="{{ url_for('static', filename='js/mobile_detection.js') }}"></script>
</head>

<body>

  <!-- âœ… í•„í„° ì˜ì—­ -->
  <section class="filter-wrapper">
    <div class="filter-section">
      {% include 'components/filters.html' %}
    </div>
    
    <!-- âœ… í–„ë²„ê±° ë©”ë‰´ì™€ ìµœì¢… ì—…ë°ì´íŠ¸ë¥¼ ë¶„ë¦¬í•´ì„œ ì •ë ¬ -->
    <div class="nav-buttons">
      <div class="nav-left">
        <div id="updatedAtText" class="updated-at-text">ìµœì¢… ì—…ë°ì´íŠ¸: -</div>
      </div>
      <div class="nav-right">
        <div class="hamburger-menu-wrapper">
          <div class="hamburger-icon" id="hamburgerIcon">
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div class="hamburger-dropdown" id="hamburgerDropdown">
            <a href="/" class="{% if request.path == '/' %}active{% endif %}">ì‚¬ì´íŠ¸ ì„±ê³¼</a>
            <a href="{{ url_for('ads_page') }}" class="{% if request.path == '/ads' %}active{% endif %}">ê´‘ê³  ì„±ê³¼</a>
            <a href="#" id="openFormModalBtn" class="form-modal-trigger">ìƒˆ í•­ëª© ì¶”ê°€</a>
            <a href="{{ url_for('auth.logout') }}">ë¡œê·¸ì•„ì›ƒ</a>
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- ë¡œë”© ì§„í–‰ë¥  í‘œì‹œ -->
  <div class="loading-progress">
    <div class="loading-progress-bar" style="width: 0%"></div>
  </div>

  <!-- âœ… ì„±ê³¼ ìš”ì•½ -->
  <section class="performance-summary-full-width">
    <div class="performance-summary-wrapper" id="performanceSummaryWrapper">
      <div id="loadingOverlayPerformanceSummary" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
      {% include 'components/performance_summary_table.html' %}
      <div id="pagination_performance_summary" class="pagination"></div>
    </div>
  </section>

  <!-- âœ… ë§¤ì¶œ / ìœ ì… êµ¬ë¶„ì„  -->
  <div class="section-divider">ë§¤ì¶œ / ìœ ì…</div>

  <!-- âœ… ì¹´í˜24 ë§¤ì¶œ + GA4 ìœ ì… -->
  <div class="container">
    <div class="tables-row">
      <section class="table-wrapper left-wide loading-check-wrapper" data-widget-id="cafe24-sales">
        <h2>ì¹´í˜24 ë§¤ì¶œ</h2>
        <div id="loadingOverlayCafe24Sales" class="loading-overlay">
          <div class="spinner"></div>
          <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
        <div class="table-content-container">
          {% include 'components/cafe24_sales_table.html' %}
        </div>
        <div id="pagination_cafe24_sales" class="pagination"></div>
      </section>

      <section class="table-wrapper right-narrow loading-check-wrapper" data-widget-id="ga4-source">
        <h2>GA4 ì†ŒìŠ¤ë³„ ìœ ì…ìˆ˜</h2>
        <div id="loadingOverlayGa4Source" class="loading-overlay">
          <div class="spinner"></div>
          <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
        <div style="text-align: right; margin-bottom: 8px;">
            <span style="font-size: 11px; color: #666; font-weight: normal;">ì´íƒˆë¥  : ì„¸ì…˜ì´ 10ì´ˆ ë¯¸ë§Œì´ê³  1ê°œ ì´ë²¤íŠ¸ë§Œ ë°œìƒí•œ ê²½ìš°</span>
        </div>
        <div class="table-content-container">
          {% include 'components/ga4_source_summary_table.html' %}
        </div>
        <div id="pagination_ga4_source_summary" class="pagination"></div>
      </section>
    </div>

    <section class="table-wrapper full-wide loading-check-wrapper">
      <h2>[ì›”ë³„] ë§¤ì¶œ/ìœ ì…</h2>
      <div id="loadingOverlayMonthlyChart" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
      <div class="table-content-container">
        {% include 'components/monthly_net_sales_visitors_chart.html' %}
      </div>
    </section>
  </div>

  <!-- âœ… ìƒí’ˆ íŒë§¤ ë° ì¡°íšŒ -->
  <div class="section-divider">ìƒí’ˆ íŒë§¤ ë° ì¡°íšŒ</div>

  <div class="container">
    <div class="tables-row">
      <section class="table-wrapper left-wide loading-check-wrapper">
        <h2>ì¹´í˜24 ìƒí’ˆ íŒë§¤</h2>
        <div id="loadingOverlayCafe24Products" class="loading-overlay">
          <div class="spinner"></div>
          <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
        <div class="table-content-container">
          {% include 'components/cafe24_product_sales_table.html' %}
        </div>
        <div id="pagination_cafe24_product_sales" class="pagination"></div>
      </section>

      <section class="table-wrapper right-narrow loading-check-wrapper">
        <h2>GA4 ìƒí’ˆë³„ ì¡°íšŒìˆ˜</h2>
        <div id="loadingOverlayViewitemSummary" class="loading-overlay">
          <div class="spinner"></div>
          <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
        <div class="table-content-container">
          {% include 'components/viewitem_summary_table.html' %}
        </div>
        <div id="pagination_viewitem_summary" class="pagination"></div>
      </section>
    </div>

    <section class="table-wrapper full-wide loading-check-wrapper">
      <h2>ì£¼ìš” ìƒí’ˆ ë§¤ì¶œ ë¹„ì¤‘</h2>
      <div id="loadingOverlayProductSalesRatio" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
      <!-- ì´ ë¶€ë¶„ì€ ë‚´ë¶€ì— í…Œì´ë¸”+ì°¨íŠ¸ êµ¬ì¡° ìˆìŒ â†’ ê°ì‹¸ê¸° ë¶ˆí•„ìš” -->
      {% include 'components/product_sales_ratio.html' %}
    </section>
  </div>

  <!-- âœ… í”Œë«í¼ ê´€ë ¨ ë°ì´í„° -->
  <div class="section-divider">ì»¤ìŠ¤í…€ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²°</div>

  <div class="container">
    <!-- âœ… í”Œë«í¼ ë§¤ì¶œ ìš”ì•½ -->
    <section class="table-wrapper full-wide loading-check-wrapper">
      <h2>í”Œë«í¼ë³„ ë§¤ì¶œ ìš”ì•½</h2>
      {% include 'components/platform_sales_summary_table.html' %}
    </section>

    <!-- âœ… ì›”ë³„ í”Œë«í¼ ë§¤ì¶œ -->
    <section class="table-wrapper full-wide loading-check-wrapper">
      <h2>ì›”ë³„ í”Œë«í¼ ë§¤ì¶œ</h2>
      {% include 'components/platform_sales_monthly.html' %}
      <div id="pagination_platform_sales_monthly" class="pagination"></div>
    </section>
  </div>

  <!-- âœ… JS ë¡œë”© -->
  <!-- ğŸ”¥ common.jsë¥¼ ê°€ì¥ ë¨¼ì € ë¡œë“œ (showLoading/hideLoading í•¨ìˆ˜ ì •ì˜) -->
  <script src="{{ url_for('static', filename='js/common.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/meta_ads_insight_table.js') }}"></script>
  <script type="module" src="{{ url_for('static', filename='js/filters.js') }}"></script>
  <script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
  <!-- ğŸ”¥ dashboard.jsëŠ” common.js ë¡œë“œ í›„ì— ì‹¤í–‰ -->
  <script src="{{ url_for('static', filename='js/dashboard.js') }}?v=1.3"></script>
    <script src="{{ url_for('static', filename='js/cafe24_sales.js') }}?v=1.1"></script>
  <script src="{{ url_for('static', filename='js/cafe24_product_sales.js') }}?v=1.1"></script>
  <script src="{{ url_for('static', filename='js/performance_summary.js') }}?v=1.1"></script>
  <script src="{{ url_for('static', filename='js/viewitem_summary.js') }}?v=1.1"></script>
  <script src="{{ url_for('static', filename='js/ga4_source_summary.js') }}?v=1.2"></script>
  <script src="{{ url_for('static', filename='js/monthly_net_sales_visitors.js') }}?v=1.2"></script>
  <script src="{{ url_for('static', filename='js/product_sales_ratio.js') }}?v=3.5"></script>
  <script src="{{ url_for('static', filename='js/platform_sales_summary.js') }}?v=1.2"></script>
  <script src="{{ url_for('static', filename='js/platform_sales_ratio.js') }}?v=2.8"></script>
  <script src="{{ url_for('static', filename='js/platform_sales_monthly.js') }}?v=1.2"></script>
  <script src="{{ url_for('static', filename='js/session_timeout.js') }}?v=1.2"></script>
  <script type="module" src="{{ url_for('static', filename='js/loading_utils.js') }}?v=1.3"></script>
  <script type="module" src="{{ url_for('static', filename='js/request_utils.js') }}?v=1.3"></script>
  
  <!-- âœ… ì›”ê°„ ë¦¬í¬íŠ¸ ëª¨ë‹¬ -->
  {% include 'components/monthly_report_modal.html' %}
  <script src="{{ url_for('static', filename='js/monthly_report.js') }}?v=1.0"></script>
  
  <!-- âœ… Form Modal -->
  {% include 'components/form_modal.html' %}
  <script src="{{ url_for('static', filename='js/form_modal.js') }}?v=1.0"></script>



    <!-- ë³´ì•ˆ ê°•í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
      // âœ… ë°°í¬ í™˜ê²½ì—ì„œë§Œ ë³´ì•ˆ ê¸°ëŠ¥ í™œì„±í™”
      const isProduction = window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1';
      
      // ğŸ”¥ ì„ì‹œë¡œ ë³´ì•ˆ ê¸°ëŠ¥ ë¹„í™œì„±í™” (ë””ë²„ê¹…ìš©)
      if (false && isProduction) {
        // ê°œë°œì ë„êµ¬ ë‹¨ì¶•í‚¤ ë¹„í™œì„±í™” (ì™„ì „íˆ ë§‰ì§€ëŠ” ëª»í•˜ì§€ë§Œ ì–´ëŠ ì •ë„ ì œí•œ)
        document.addEventListener('keydown', function(e) {
          // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U ë¹„í™œì„±í™”
          if (e.key === 'F12' || 
              (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
              (e.ctrlKey && e.key === 'u')) {
            e.preventDefault();
            return false;
          }
        });
        
        // ìš°í´ë¦­ ë©”ë‰´ ì œí•œ
        document.addEventListener('contextmenu', function(e) {
          e.preventDefault();
          return false;
        });
        
        // ê°œë°œì ë„êµ¬ ê°ì§€ (ì™„ì „í•˜ì§€ëŠ” ì•ŠìŒ)
        let devtools = { open: false, orientation: null };
        setInterval(() => {
          const threshold = 160;
          if (window.outerHeight - window.innerHeight > threshold || 
              window.outerWidth - window.innerWidth > threshold) {
            if (!devtools.open) {
              devtools.open = true;
              // ê°œë°œì ë„êµ¬ê°€ ì—´ë ¸ì„ ë•Œì˜ ì²˜ë¦¬ (ì„ íƒì‚¬í•­)
              // document.body.innerHTML = 'ê°œë°œì ë„êµ¬ ì‚¬ìš©ì´ ì œí•œë©ë‹ˆë‹¤.';
            }
          } else {
            devtools.open = false;
          }
        }, 500);
      }
    </script>
</body>

</html>
