<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEP 2 - ì¹´íƒˆë¡œê·¸ ê´‘ê³ </title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=1.4">

  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: #161616;
      --bg-card-hover: #1a1a1a;
      --bg-input: #0d0d0d;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-hover: rgba(255, 255, 255, 0.12);
      --border-focus: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-blue: #3b82f6;
      --accent-emerald: #10b981;
      --accent-violet: #8b5cf6;
      --accent-amber: #f59e0b;
      --accent-red: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-primary);
      font-family: 'Pretendard', 'Inter Tight', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .font-inter { font-family: 'Inter Tight', sans-serif; }

    /* ===== ë„¤ë¹„ê²Œì´ì…˜ ì˜¤ë²„ë¼ì´ë“œ ===== */
    .nav-buttons {
      background: var(--bg-primary) !important;
      border-bottom: 1px solid var(--border-subtle) !important;
    }
    .nav-buttons .updated-at-text {
      color: var(--text-primary) !important;
      font-family: 'Inter Tight', sans-serif !important;
      font-weight: 700 !important;
      letter-spacing: 0.1em !important;
    }
    .hamburger-icon div { background: var(--text-primary) !important; }
    .hamburger-dropdown {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-subtle) !important;
    }
    .hamburger-dropdown a { color: var(--text-secondary) !important; }
    .hamburger-dropdown a:hover {
      background: var(--bg-card) !important;
      color: var(--text-primary) !important;
    }

    /* ===== Progress Bar ===== */
    .admake-progress-bar {
      position: sticky;
      top: 56px;
      z-index: 100;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, rgba(17, 17, 17, 0.95) 100%);
      border-bottom: 1px solid var(--border-subtle);
      padding: 20px 40px 18px;
      backdrop-filter: blur(12px);
    }

    .admake-progress-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      max-width: 700px;
      margin: 0 auto;
    }

    .admake-progress-step {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.3s;
      border: 1px solid transparent;
    }

    .admake-progress-step .step-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-muted);
    }

    .admake-progress-step .step-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .admake-progress-step.active {
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .admake-progress-step.active .step-number {
      font-size: 14px;
      color: #1a1a1a;
    }

    .admake-progress-step.active .step-label {
      font-size: 13px;
      font-weight: 600;
      color: #2a2a2a;
      opacity: 1;
    }

    .admake-progress-step.completed {
      background: rgba(16, 185, 129, 0.08);
      border-color: rgba(16, 185, 129, 0.15);
    }

    .admake-progress-step.completed .step-number,
    .admake-progress-step.completed .step-label {
      color: var(--accent-emerald);
      opacity: 1;
    }

    .admake-progress-connector {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 4px;
    }

    .admake-progress-connector::before,
    .admake-progress-connector::after {
      content: '';
      width: 12px;
      height: 1px;
      background: var(--border-subtle);
    }

    .admake-progress-connector-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--text-muted);
      opacity: 0.4;
    }

    .admake-progress-connector.completed::before,
    .admake-progress-connector.completed::after {
      background: var(--accent-emerald);
    }

    .admake-progress-connector.completed .admake-progress-connector-dot {
      background: var(--accent-emerald);
      opacity: 1;
    }

    /* ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== */
    .admake-wrapper {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px;
      padding-bottom: 120px;
    }

    .admake-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: start;
    }

    /* ===== ì™¼ìª½ íŒ¨ë„ ===== */
    .admake-left-panel {
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding-right: 20px;
      border-right: 1px solid rgba(39, 39, 42, 0.6);
    }

    .admake-section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }

    .admake-section-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 10px;
      font-weight: 800;
      color: var(--accent-violet);
      background: rgba(139, 92, 246, 0.08);
      border: 1px solid rgba(139, 92, 246, 0.15);
      padding: 5px 10px;
      border-radius: 4px;
      letter-spacing: 0.1em;
    }

    .admake-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* ===== íƒ€ê²ŸíŒ… í”„ë¦¬ì…‹ ===== */
    .targeting-presets {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .targeting-preset {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      padding: 18px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .targeting-preset:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }

    .targeting-preset.selected {
      background: rgba(139, 92, 246, 0.08);
      border-color: rgba(139, 92, 246, 0.3);
    }

    .targeting-radio {
      width: 20px;
      height: 20px;
      border: 2px solid var(--text-muted);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 2px;
    }

    .targeting-preset.selected .targeting-radio {
      border-color: var(--accent-violet);
    }

    .targeting-radio::after {
      content: '';
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: transparent;
      transition: background 0.2s;
    }

    .targeting-preset.selected .targeting-radio::after {
      background: var(--accent-violet);
    }

    .targeting-info {
      flex: 1;
    }

    .targeting-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .targeting-icon {
      font-size: 18px;
    }

    .targeting-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .targeting-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .targeting-tag {
      font-size: 10px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 4px;
      background: rgba(16, 185, 129, 0.15);
      color: var(--accent-emerald);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    /* ===== ê¸°ê°„ ì„¤ì • ===== */
    .retention-section {
      margin-top: 24px;
      padding: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
    }

    .retention-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .retention-label-icon {
      width: 20px;
      height: 20px;
      background: rgba(245, 158, 11, 0.1);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .retention-slider-container {
      margin-bottom: 16px;
    }

    .retention-slider {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      background: var(--bg-input);
      border-radius: 3px;
      outline: none;
    }

    .retention-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--accent-violet);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
    }

    .retention-value {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .retention-value-display {
      font-family: 'Inter Tight', sans-serif;
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .retention-value-unit {
      font-size: 14px;
      color: var(--text-muted);
    }

    .retention-presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .retention-preset-btn {
      padding: 6px 12px;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .retention-preset-btn:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }

    .retention-preset-btn.active {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(139, 92, 246, 0.3);
      color: var(--accent-violet);
    }

    /* ===== ì œì™¸ ì¡°ê±´ ===== */
    .exclusion-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-subtle);
    }

    .exclusion-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
    }

    .exclusion-toggle-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .toggle-switch {
      width: 44px;
      height: 24px;
      background: var(--bg-input);
      border-radius: 12px;
      position: relative;
      transition: background 0.2s;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 18px;
      height: 18px;
      background: var(--text-muted);
      border-radius: 50%;
      transition: all 0.2s;
    }

    .toggle-switch.active {
      background: var(--accent-violet);
    }

    .toggle-switch.active::after {
      left: 23px;
      background: white;
    }

    .exclusion-options {
      margin-top: 16px;
      display: none;
    }

    .exclusion-options.active {
      display: block;
    }

    .exclusion-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--bg-input);
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .exclusion-option:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .exclusion-checkbox {
      width: 16px;
      height: 16px;
      border: 2px solid var(--text-muted);
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .exclusion-option.selected .exclusion-checkbox {
      background: var(--accent-violet);
      border-color: var(--accent-violet);
    }

    .exclusion-checkbox svg {
      width: 10px;
      height: 10px;
      stroke: white;
      stroke-width: 3;
      fill: none;
      opacity: 0;
    }

    .exclusion-option.selected .exclusion-checkbox svg {
      opacity: 1;
    }

    .exclusion-text {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* ===== ì˜¤ë¥¸ìª½ íŒ¨ë„: ìš”ì•½ ===== */
    .admake-right-panel {
      position: sticky;
      top: 180px;
    }

    .summary-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
    }

    .summary-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .summary-icon {
      width: 36px;
      height: 36px;
      background: rgba(139, 92, 246, 0.08);
      border: 1px solid rgba(139, 92, 246, 0.15);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .summary-icon svg {
      width: 18px;
      height: 18px;
      stroke: var(--accent-violet);
      fill: none;
    }

    .summary-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .summary-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }

    .summary-item-label {
      font-size: 13px;
      color: var(--text-muted);
    }

    .summary-item-value {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      text-align: right;
      max-width: 60%;
    }

    .summary-divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 8px 0;
    }

    .summary-note {
      padding: 14px;
      background: rgba(245, 158, 11, 0.08);
      border: 1px solid rgba(245, 158, 11, 0.15);
      border-radius: 10px;
      margin-top: 8px;
    }

    .summary-note-text {
      font-size: 12px;
      color: var(--accent-amber);
      line-height: 1.5;
    }

    /* ===== í•˜ë‹¨ ì•¡ì…˜ ë°” ===== */
    .admake-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(10, 10, 10, 0) 0%, var(--bg-primary) 20%);
      padding: 24px 40px;
      z-index: 100;
    }

    .admake-action-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .admake-action-left {
      font-family: 'Inter Tight', sans-serif;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .admake-action-buttons {
      display: flex;
      gap: 12px;
    }

    .admake-btn {
      padding: 12px 28px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .admake-btn-secondary {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
    }

    .admake-btn-secondary:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .admake-btn-primary {
      background: var(--accent-violet);
      color: white;
    }

    .admake-btn-primary:hover {
      background: #7c3aed;
    }

    .admake-btn-primary:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* ===== ë°˜ì‘í˜• ===== */
    @media (max-width: 1024px) {
      .admake-layout {
        grid-template-columns: 1fr;
      }
      .admake-left-panel {
        padding-right: 0;
        border-right: none;
      }
      .admake-right-panel {
        position: static;
      }
    }
  </style>
</head>
<body>

<script>
  var userCompanyList = {{ session['company_names'] | tojson }};
  var currentUserId = "{{ session['user_id'] }}";
  var accountId = "{{ account_id }}";
</script>
<script src="{{ url_for('static', filename='js/mobile_detection.js') }}"></script>

<!-- ë„¤ë¹„ê²Œì´ì…˜ -->
<div class="nav-buttons">
  <div class="nav-left">
    <div id="updatedAtText" class="updated-at-text">AdCanvas</div>
  </div>
  <div class="nav-right">
    <div class="hamburger-menu-wrapper">
      <div class="hamburger-icon" id="hamburgerIcon">
        <div></div><div></div><div></div>
      </div>
      <div class="hamburger-dropdown" id="hamburgerDropdown">
        <a href="/">ì‚¬ì´íŠ¸ ì„±ê³¼</a>
        <a href="{{ url_for('ads_page') }}">ê´‘ê³  ì„±ê³¼</a>
        <a href="{{ url_for('admake_page') }}?account_id={{ account_id }}">AdCanvas</a>
        <a href="{{ url_for('auth.logout') }}">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </div>
</div>

<!-- Progress Bar -->
<div class="admake-progress-bar">
  <div class="admake-progress-steps">
    <div class="admake-progress-step completed">
      <span class="step-number font-inter">01</span>
      <span class="step-label">ì œí’ˆ ì„¸íŠ¸</span>
    </div>
    <div class="admake-progress-connector completed">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step active">
      <span class="step-number font-inter">02</span>
      <span class="step-label">íƒ€ê²ŸíŒ…</span>
    </div>
    <div class="admake-progress-connector">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step">
      <span class="step-number font-inter">03</span>
      <span class="step-label">ê´‘ê³  ë¬¸êµ¬</span>
    </div>
    <div class="admake-progress-connector">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step">
      <span class="step-number font-inter">04</span>
      <span class="step-label">ê²€í†  & ê²Œì‹œ</span>
    </div>
  </div>
</div>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="admake-wrapper">
  <div class="admake-layout">

    <!-- ì™¼ìª½ íŒ¨ë„: íƒ€ê²ŸíŒ… ì„¤ì • -->
    <div class="admake-left-panel">
      <div class="admake-section-header">
        <span class="admake-section-number font-inter">02</span>
        <span class="admake-section-title">íƒ€ê²Ÿ & ë¦¬íƒ€ê²ŸíŒ… ì„¤ì •</span>
      </div>

      <!-- íƒ€ê²ŸíŒ… í”„ë¦¬ì…‹ -->
      <div class="targeting-presets">
        <!-- í”„ë¦¬ì…‹ 1: ì¡°íšŒ/ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤ -->
        <div class="targeting-preset selected" data-type="retarget_view_cart">
          <div class="targeting-radio"></div>
          <div class="targeting-info">
            <div class="targeting-header">
              <span class="targeting-icon">ğŸ”</span>
              <span class="targeting-title">ì¡°íšŒ/ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤</span>
              <span class="targeting-tag">ì¶”ì²œ</span>
            </div>
            <div class="targeting-desc">
              ìƒí’ˆì„ ì¡°íšŒí•˜ê±°ë‚˜ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìœ¼ë‚˜ êµ¬ë§¤í•˜ì§€ ì•Šì€ ì‚¬ëŒì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤
            </div>
          </div>
        </div>

        <!-- í”„ë¦¬ì…‹ 2: ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤ -->
        <div class="targeting-preset" data-type="retarget_cart">
          <div class="targeting-radio"></div>
          <div class="targeting-info">
            <div class="targeting-header">
              <span class="targeting-icon">ğŸ›’</span>
              <span class="targeting-title">ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤</span>
            </div>
            <div class="targeting-desc">
              ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìœ¼ë‚˜ êµ¬ë§¤í•˜ì§€ ì•Šì€ ì‚¬ëŒì—ê²Œë§Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤
            </div>
          </div>
        </div>

        <!-- í”„ë¦¬ì…‹ 3: ì—…ì…€/í¬ë¡œìŠ¤ì…€ -->
        <div class="targeting-preset" data-type="upsell">
          <div class="targeting-radio"></div>
          <div class="targeting-info">
            <div class="targeting-header">
              <span class="targeting-icon">ğŸ”„</span>
              <span class="targeting-title">ì—…ì…€ / í¬ë¡œìŠ¤ì…€</span>
            </div>
            <div class="targeting-desc">
              ì´ë¯¸ êµ¬ë§¤í•œ ê³ ê°ì—ê²Œ ë‹¤ë¥¸ ìƒí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤
            </div>
          </div>
        </div>

        <!-- í”„ë¦¬ì…‹ 4: ê´‘ë²”ìœ„ íƒ€ê²ŸíŒ… -->
        <div class="targeting-preset" data-type="broad">
          <div class="targeting-radio"></div>
          <div class="targeting-info">
            <div class="targeting-header">
              <span class="targeting-icon">ğŸŒ</span>
              <span class="targeting-title">ê´‘ë²”ìœ„ íƒ€ê²ŸíŒ…</span>
            </div>
            <div class="targeting-desc">
              ì‹ ê·œ ê³ ê° í™•ë³´ë¥¼ ìœ„í•´ ë„“ì€ íƒ€ê²Ÿì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>

      <!-- ê¸°ê°„ ì„¤ì • -->
      <div class="retention-section">
        <div class="retention-label">
          <div class="retention-label-icon">ğŸ“…</div>
          <span>ë¦¬íƒ€ê²ŸíŒ… ê¸°ê°„</span>
        </div>
        <div class="retention-slider-container">
          <input type="range" class="retention-slider" id="retentionSlider" min="1" max="180" value="14">
        </div>
        <div class="retention-value">
          <div>
            <span class="retention-value-display font-inter" id="retentionValue">14</span>
            <span class="retention-value-unit">ì¼</span>
          </div>
          <div class="retention-presets">
            <button class="retention-preset-btn" data-days="7">7ì¼</button>
            <button class="retention-preset-btn active" data-days="14">14ì¼</button>
            <button class="retention-preset-btn" data-days="30">30ì¼</button>
            <button class="retention-preset-btn" data-days="60">60ì¼</button>
          </div>
        </div>

        <!-- ì œì™¸ ì¡°ê±´ -->
        <div class="exclusion-section">
          <div class="exclusion-toggle">
            <span class="exclusion-toggle-label">ì œì™¸ ì¡°ê±´ ì¶”ê°€</span>
            <div class="toggle-switch active" id="exclusionToggle"></div>
          </div>
          <div class="exclusion-options active" id="exclusionOptions">
            <div class="exclusion-option selected" data-event="Purchase">
              <div class="exclusion-checkbox">
                <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
              </div>
              <span class="exclusion-text">ì´ë¯¸ êµ¬ë§¤í•œ ì‚¬ëŒ ì œì™¸</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„: ìš”ì•½ -->
    <div class="admake-right-panel">
      <div class="summary-card">
        <div class="summary-header">
          <div class="summary-icon">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M12 6v6l4 2"></path>
            </svg>
          </div>
          <span class="summary-title">íƒ€ê²ŸíŒ… ìš”ì•½</span>
        </div>
        <div class="summary-content">
          <div class="summary-item">
            <span class="summary-item-label">ì œí’ˆ ì„¸íŠ¸</span>
            <span class="summary-item-value" id="summaryProductSet">-</span>
          </div>
          <div class="summary-divider"></div>
          <div class="summary-item">
            <span class="summary-item-label">íƒ€ê²ŸíŒ… ìœ í˜•</span>
            <span class="summary-item-value" id="summaryTargetType">ì¡°íšŒ/ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤</span>
          </div>
          <div class="summary-item">
            <span class="summary-item-label">ê¸°ê°„</span>
            <span class="summary-item-value" id="summaryRetention">ìµœê·¼ 14ì¼</span>
          </div>
          <div class="summary-item">
            <span class="summary-item-label">ì œì™¸ ì¡°ê±´</span>
            <span class="summary-item-value" id="summaryExclusion">êµ¬ë§¤ì ì œì™¸</span>
          </div>
        </div>
        <div class="summary-note">
          <div class="summary-note-text">
            ğŸ’¡ ì§€ë‚œ 14ì¼ ë™ì•ˆ í•´ë‹¹ ì œí’ˆì„ ì¡°íšŒí•˜ê±°ë‚˜ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ì‚¬ëŒë“¤ì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- í•˜ë‹¨ ì•¡ì…˜ ë°” -->
<div class="admake-action-bar">
  <div class="admake-action-inner">
    <div class="admake-action-left font-inter">STEP 2 OF 4</div>
    <div class="admake-action-buttons">
      <button class="admake-btn admake-btn-secondary" id="prevBtn">ì´ì „</button>
      <button class="admake-btn admake-btn-primary" id="nextBtn">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/common_ui.js') }}"></script>

<script>
$(document).ready(function() {
    // Step 1 ë°ì´í„° ë¡œë“œ
    const step1Data = JSON.parse(sessionStorage.getItem('catalogAdStep1') || '{}');
    if (!step1Data.selectedSetId && !step1Data.isNewSet) {
        // Step 1 ë¯¸ì™„ë£Œ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸
        window.location.href = "/admake/catalog/step1?account_id=" + encodeURIComponent(accountId);
        return;
    }

    // ì œí’ˆ ì„¸íŠ¸ í‘œì‹œ
    $("#summaryProductSet").text(step1Data.selectedSetName || step1Data.newSetName || '-');

    // ìƒíƒœ ê´€ë¦¬
    let targetingType = 'retarget_view_cart';
    let retentionDays = 14;
    let excludePurchase = true;

    // ê¸°ì¡´ ì„¸ì…˜ ë°ì´í„° ë³µì›
    const savedData = sessionStorage.getItem('catalogAdStep2');
    if (savedData) {
        const data = JSON.parse(savedData);
        targetingType = data.targetingType || 'retarget_view_cart';
        retentionDays = data.retentionDays || 14;
        excludePurchase = data.excludePurchase !== false;

        // UI ë³µì›
        $(`.targeting-preset[data-type="${targetingType}"]`).click();
        $("#retentionSlider").val(retentionDays);
        updateRetentionDisplay(retentionDays);
    }

    // íƒ€ê²ŸíŒ… í”„ë¦¬ì…‹ ì„ íƒ
    $(".targeting-preset").on("click", function() {
        $(".targeting-preset").removeClass("selected");
        $(this).addClass("selected");

        targetingType = $(this).data("type");
        const title = $(this).find(".targeting-title").text();
        $("#summaryTargetType").text(title);

        updateSummaryNote();
    });

    // ê¸°ê°„ ìŠ¬ë¼ì´ë”
    $("#retentionSlider").on("input", function() {
        retentionDays = parseInt($(this).val());
        updateRetentionDisplay(retentionDays);
    });

    function updateRetentionDisplay(days) {
        $("#retentionValue").text(days);
        $("#summaryRetention").text(`ìµœê·¼ ${days}ì¼`);

        // í”„ë¦¬ì…‹ ë²„íŠ¼ í™œì„±í™”
        $(".retention-preset-btn").removeClass("active");
        $(`.retention-preset-btn[data-days="${days}"]`).addClass("active");

        updateSummaryNote();
    }

    // ê¸°ê°„ í”„ë¦¬ì…‹ ë²„íŠ¼
    $(".retention-preset-btn").on("click", function() {
        const days = parseInt($(this).data("days"));
        $("#retentionSlider").val(days);
        retentionDays = days;
        updateRetentionDisplay(days);
    });

    // ì œì™¸ ì¡°ê±´ í† ê¸€
    $("#exclusionToggle").on("click", function() {
        $(this).toggleClass("active");
        $("#exclusionOptions").toggleClass("active");

        if ($(this).hasClass("active")) {
            excludePurchase = $(".exclusion-option.selected").length > 0;
        } else {
            excludePurchase = false;
        }

        updateExclusionSummary();
    });

    // ì œì™¸ ì¡°ê±´ ì„ íƒ
    $(".exclusion-option").on("click", function() {
        $(this).toggleClass("selected");
        excludePurchase = $(this).hasClass("selected");
        updateExclusionSummary();
    });

    function updateExclusionSummary() {
        if (excludePurchase) {
            $("#summaryExclusion").text("êµ¬ë§¤ì ì œì™¸");
        } else {
            $("#summaryExclusion").text("ì—†ìŒ");
        }
        updateSummaryNote();
    }

    function updateSummaryNote() {
        let noteText = "";
        const days = retentionDays;

        switch (targetingType) {
            case 'retarget_view_cart':
                noteText = `ğŸ’¡ ì§€ë‚œ ${days}ì¼ ë™ì•ˆ í•´ë‹¹ ì œí’ˆì„ ì¡°íšŒí•˜ê±°ë‚˜ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ì‚¬ëŒë“¤ì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤`;
                break;
            case 'retarget_cart':
                noteText = `ğŸ’¡ ì§€ë‚œ ${days}ì¼ ë™ì•ˆ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì•˜ìœ¼ë‚˜ êµ¬ë§¤í•˜ì§€ ì•Šì€ ì‚¬ëŒë“¤ì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•©ë‹ˆë‹¤`;
                break;
            case 'upsell':
                noteText = `ğŸ’¡ ì§€ë‚œ ${days}ì¼ ë™ì•ˆ êµ¬ë§¤í•œ ê³ ê°ì—ê²Œ ë‹¤ë¥¸ ì œí’ˆì„ ì¶”ì²œí•©ë‹ˆë‹¤`;
                break;
            case 'broad':
                noteText = `ğŸ’¡ ë„“ì€ íƒ€ê²Ÿì—ê²Œ ê´‘ê³ ë¥¼ ë…¸ì¶œí•˜ì—¬ ì‹ ê·œ ê³ ê°ì„ í™•ë³´í•©ë‹ˆë‹¤`;
                break;
        }

        if (excludePurchase && targetingType !== 'upsell') {
            noteText += " (êµ¬ë§¤ì ì œì™¸)";
        }

        $(".summary-note-text").html(noteText);
    }

    // ì´ì „ ë²„íŠ¼
    $("#prevBtn").on("click", function() {
        window.location.href = "/admake/catalog/step1?account_id=" + encodeURIComponent(accountId);
    });

    // ë‹¤ìŒ ë²„íŠ¼
    $("#nextBtn").on("click", function() {
        // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
        const data = {
            targetingType: targetingType,
            retentionDays: retentionDays,
            excludePurchase: excludePurchase
        };
        sessionStorage.setItem('catalogAdStep2', JSON.stringify(data));

        // Step 3ìœ¼ë¡œ ì´ë™
        window.location.href = "/admake/catalog/step3?account_id=" + encodeURIComponent(accountId);
    });

    // ì´ˆê¸° ìš”ì•½ ì—…ë°ì´íŠ¸
    updateSummaryNote();
});
</script>

</body>
</html>
