# 2025-12 환불 데이터 복구 - 다음 단계

## ✅ 완료된 작업
- [x] 환불 데이터 수집 (`recover_2025_12_refunds.py` 완료)
  - 28건의 환불 레코드 (order_item_code로 분리)
  - 23건의 실제 환불 주문
  - 총 환불 금액: 2,301,341원

## 🔄 다음 단계

### 1단계: daily_cafe24_sales 삭제 (필수)
```
→ delete_2025_12_data.sql 실행
  - Step 0: 삭제할 데이터 확인
  - Step 1: daily_cafe24_sales의 2025-12 데이터 삭제
  - Step 4: 삭제 확인
```

### 2단계: daily_cafe24_sales 재수집
```
→ python recover_2025_12_data.py
```

이 스크립트는:
- 2025-12-01 ~ 2025-12-31 일자별로 처리
- 환불을 **원래 주문의 payment_date 기준**으로 집계
- ✅ JOIN 버그 수정됨 (`r.payment_date` 사용)

### 3단계: 최종 확인
```
→ check_2025_12_refunds_status.sql 실행
```

확인 사항:
- `daily_cafe24_sales`에 환불 데이터가 정상 반영되었는지
- 총 환불 금액이 2,301,341원과 일치하는지
- 일자별 환불 금액이 올바르게 집계되었는지

## 📊 참고 사항

**환불 집계 기준:**
- 환불은 `refund_date`(환불 발생일)가 아니라 **`payment_date`(원래 주문 결제일)** 기준으로 집계됩니다.
- 예: 2025-11-29에 결제한 주문이 2025-12-05에 환불되면 → 2025-11-29의 매출에서 환불이 차감됩니다.

**일부 환불의 원래 주문 결제일이 11월인 이유:**
- 11월에 주문한 상품이 12월에 환불된 경우
- 이는 정상적인 비즈니스 로직입니다
- 11월 매출에서 환불이 차감되어야 합니다

## ⚠️ 주의
`delete_2025_12_data.sql`을 실행하여 잘못된 환불 집계 데이터를 삭제한 후 재수집해야 정확한 데이터가 저장됩니다.

