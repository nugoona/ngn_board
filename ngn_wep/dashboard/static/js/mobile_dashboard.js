// File: ngn_wep/dashboard/static/js/mobile_dashboard.js
// ëª¨ë°”ì¼ ëŒ€ì‹œë³´ë“œ JavaScript ì—”íŠ¸ë¦¬í¬ì¸íŠ¸

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1) ì „ì—­ ë³€ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let mobileData = null;
let isLoading = false;

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 2) ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function formatNumber(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toLocaleString();
}

function formatCurrency(num) {
    return 'â‚©' + num.toLocaleString();
}

function formatPercentage(num) {
    return num.toFixed(1) + '%';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 3) API í˜¸ì¶œ í•¨ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchMobileData() {
    if (isLoading) return;
    
    isLoading = true;
    console.log('ðŸ”„ ëª¨ë°”ì¼ ë°ì´í„° ë¡œë”© ì‹œìž‘...');
    
    try {
        // POST ìš”ì²­ìœ¼ë¡œ ë³€ê²½ (ê¸°ì¡´ ì›¹ê³¼ ë™ì¼í•œ ë°©ì‹)
        const response = await fetch('/m/get_data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                company_name: 'all',  // ê¸°ë³¸ê°’
                period: 'last7days',  // ëª¨ë°”ì¼ ê¸°ë³¸ê°’: ìµœê·¼ 7ì¼
                data_type: 'all'
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('âœ… ëª¨ë°”ì¼ ë°ì´í„° ë¡œë”© ì„±ê³µ:', data);
        
        // 1ë‹¨ê³„: ì½˜ì†”ì— ì°ê¸°ë§Œ (ë Œë”ë§ì€ 2ë‹¨ê³„ì—ì„œ)
        mobileData = data;
        
        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        const lastUpdated = document.getElementById('last-updated');
        if (lastUpdated && data.last_updated) {
            const date = new Date(data.last_updated);
            lastUpdated.textContent = `ì—…ë°ì´íŠ¸: ${date.toLocaleTimeString()}`;
        }
        
    } catch (error) {
        console.error('âŒ ëª¨ë°”ì¼ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
        showError('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
    } finally {
        isLoading = false;
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 4) ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showError(message) {
    console.error('ðŸš¨ ì—ëŸ¬:', message);
    // 1ë‹¨ê³„: ì½˜ì†”ì—ë§Œ í‘œì‹œ
    // 2ë‹¨ê³„ì—ì„œ toast ë©”ì‹œì§€ êµ¬í˜„ ì˜ˆì •
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 5) í•„í„° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setupFilters() {
    const companySelect = document.getElementById('company-select');
    const startDate = document.getElementById('start-date');
    
    if (companySelect) {
        companySelect.addEventListener('change', () => {
            console.log('ðŸ¢ ì—…ì²´ ë³€ê²½:', companySelect.value);
            // 2ë‹¨ê³„ì—ì„œ API ìž¬í˜¸ì¶œ êµ¬í˜„ ì˜ˆì •
        });
    }
    
    if (startDate) {
        startDate.addEventListener('change', () => {
            console.log('ðŸ“… ë‚ ì§œ ë³€ê²½:', startDate.value);
            // 2ë‹¨ê³„ì—ì„œ API ìž¬í˜¸ì¶œ êµ¬í˜„ ì˜ˆì •
        });
    }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 6) ì´ˆê¸°í™” í•¨ìˆ˜
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initMobileDashboard() {
    console.log('ðŸš€ ëª¨ë°”ì¼ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì‹œìž‘...');
    
    // í•„í„° ì„¤ì •
    setupFilters();
    
    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    fetchMobileData();
    
    console.log('âœ… ëª¨ë°”ì¼ ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 7) DOM ë¡œë“œ ì‹œ ì´ˆê¸°í™”
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('DOMContentLoaded', initMobileDashboard);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 8) ë””ë²„ê¹…ìš© ì „ì—­ í•¨ìˆ˜ (ê°œë°œìš©)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.mobileDashboard = {
    fetchData: fetchMobileData,
    getData: () => mobileData,
    isLoading: () => isLoading
}; 