<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>META ê´‘ê³  ì„±ê³¼</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- âœ… ApexCharts ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.css">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.45.1/dist/apexcharts.min.js"></script>
  <!-- âœ… ECharts ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=1.4">

</head>
<body>

<!-- âœ… ì „ì²´ í˜ì´ì§€ ë¡œë”© ì˜¤ë²„ë ˆì´ (CATALOG ë²„íŠ¼ìš©) -->
<div id="fullPageLoadingOverlay" class="full-page-loading-overlay" style="display: none;">
  <div class="full-page-loading-content">
    <div class="full-page-spinner"></div>
    <div class="full-page-loading-text">ì¹´íƒˆë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>
</div>

<script>
  var userCompanyList = {{ session['company_names'] | tojson }};
  var currentUserId = "{{ session['user_id'] }}";
</script>
<script src="{{ url_for('static', filename='js/mobile_detection.js') }}"></script>

<!-- âœ… í–„ë²„ê±° ë©”ë‰´ ë° ìµœì¢… ì—…ë°ì´íŠ¸ -->
<div class="nav-buttons">
  <div class="nav-left">
    <div id="updatedAtText" class="updated-at-text">ìµœì¢… ì—…ë°ì´íŠ¸: -</div>
  </div>
  <div class="nav-right">
    <div class="hamburger-menu-wrapper">
      <div class="hamburger-icon" id="hamburgerIcon">
        <div></div><div></div><div></div>
      </div>
      <div class="hamburger-dropdown" id="hamburgerDropdown">
        <a href="/" class="{% if request.path == '/' %}active{% endif %}">ì‚¬ì´íŠ¸ ì„±ê³¼</a>
        <a href="{{ url_for('ads_page') }}" class="{% if request.path == '/ads' %}active{% endif %}">ê´‘ê³  ì„±ê³¼</a>
        <a href="{{ url_for('auth.logout') }}">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </div>
</div>


<!-- âœ… ê³µí†µ í•„í„° -->
<section class="filter-wrapper">
  <div class="filter-section">
    {% include 'components/filters.html' %}
  </div>
</section>

<!-- âœ… ë©”íƒ€ ê´‘ê³  ì„±ê³¼ í…Œì´ë¸” -->
<div class="container meta-ads-wrapper">
  <section class="table-wrapper full-wide loading-check-wrapper" data-widget-id="meta-ads-insight">
    <h2 class="summary-section-title">META ê´‘ê³  ì„±ê³¼</h2>
    
    <!-- âœ… ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div id="loadingOverlayMetaAdsInsight" class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
    
    <div class="table-content-container">
      {% include 'components/meta_ads_insight_table.html' %}
    </div>
  </section>
</div>

<!-- âœ… ìº í˜ì¸ ëª©í‘œë³„ ìš”ì•½ í…Œì´ë¸” (í† ê¸€) -->
<div id="typeSummaryContainer" class="container" style="display: none;">
  <section class="table-wrapper full-wide loading-check-wrapper" data-widget-id="meta-ads-type-summary">
    <h2 class="summary-section-title">ìº í˜ì¸ ëª©í‘œë³„ ì„±ê³¼ ìš”ì•½</h2>
    
    <!-- âœ… ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <div id="loadingOverlayTypeSummary" class="loading-overlay">
      <div class="spinner"></div>
      <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>
    
    <div class="table-content-container">
      {% include 'components/meta_ads_adset_summary_by_type_table.html' %}
    </div>
  </section>
</div>

<!-- âœ… ê´‘ê³  ë¯¸ë¦¬ë³´ê¸° + ìŠ¬ë¼ì´ë“œ/ì½œë ‰ì…˜ ê´‘ê³  -->
<div class="container">
  <div class="tables-row">
    <!-- ì¢Œì¸¡: ë‹¨ì¼ ì´ë¯¸ì§€/ì˜ìƒ -->
    <section class="table-wrapper left-wide loading-check-wrapper" data-widget-id="ads-preview">
      <h2 class="summary-section-title">LIVE ê´‘ê³  ë¯¸ë¦¬ë³´ê¸° - ë‹¨ì¼ ì´ë¯¸ì§€/ì˜ìƒ</h2>
      
      <!-- âœ… ë¡œë”© ìŠ¤í”¼ë„ˆ -->
      <div id="loadingOverlayAdsPreview" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
      
      <div class="table-content-container">
        <div id="previewCardContainer" style="margin-top: 20px;"></div>
        {% include 'components/meta_ads_preview_cards.html' %}
      </div>
    </section>

    <!-- ìš°ì¸¡: ìŠ¬ë¼ì´ë“œ/ì½œë ‰ì…˜ ê´‘ê³  -->
    <section class="table-wrapper right-narrow loading-check-wrapper" data-widget-id="slide-collection">
      <h2 class="summary-section-title">LIVE ê´‘ê³  ë¯¸ë¦¬ë³´ê¸° - ìŠ¬ë¼ì´ë“œ/ì½œë ‰ì…˜[ì‹¤ê³„ì •]</h2>
      
      <!-- âœ… ë¡œë”© ìŠ¤í”¼ë„ˆ -->
      <div id="loadingOverlaySlideCollection" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
      </div>
      
      <div class="table-content-container">
        <div id="slideCollectionContainer" class="table-content-container" style="margin-top: 20px; overflow-x: auto;">
          {% include 'components/meta_ads_slide_collection_table.html' %}
        </div>
      </div>
    </section>
  </div>
</div>

<!-- âœ… ì¹´íƒˆë¡œê·¸ ì‚¬ì´ë“œë°” (ìŠ¬ë¼ì´ë“œ ë°©ì‹ + ë‹«ê¸° ë²„íŠ¼ í¬í•¨) -->
{% include "components/catalog_sidebar.html" %}

<!-- âœ… ì¹´íƒˆë¡œê·¸ ë¡œë”© íŒì—… -->
<div id="catalogLoadingPopup" class="catalog-loading-popup hidden">
  <div class="catalog-loading-content">
    <div class="spinner"></div>
    <div class="loading-text" style="color: white !important; display: block !important; font-size: 16px !important; font-weight: 500 !important; text-align: center !important; margin-top: 20px !important;">ì¹´íƒˆë¡œê·¸ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>
</div>

<!-- âœ… ê³µí†µ ìœ í‹¸ (ìºì‹œ ë²„ì „ í†µì¼) -->
<!-- âœ… JS ë¡œë”© -->
<!-- ğŸ”¥ common.jsë¥¼ ê°€ì¥ ë¨¼ì € ë¡œë“œ (showLoading/hideLoading í•¨ìˆ˜ ì •ì˜) -->
<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/common_ui.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/meta_ads_insight_table.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/filters.js') }}"></script>
<script src="{{ url_for('static', filename='js/pagination.js') }}"></script>
<!-- ğŸ”¥ dashboard.jsëŠ” common.js ë¡œë“œ í›„ì— ì‹¤í–‰ -->
<script src="{{ url_for('static', filename='js/dashboard.js') }}?v=1.2"></script>
<script type="module" src="{{ url_for('static', filename='js/meta_ads_preview.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/meta_ads_slide_collection.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/meta_ads_adset_summary_by_type.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/catalog_sidebar.js') }}"></script>
<script src="{{ url_for('static', filename='js/session_timeout.js') }}?v=1.1"></script>
<script type="module" src="{{ url_for('static', filename='js/loading_utils.js') }}?v=1.1"></script>
<script type="module" src="{{ url_for('static', filename='js/request_utils.js') }}?v=1.1"></script>
<script type="module" src="{{ url_for('static', filename='js/fetch_data.js') }}?v=1.1"></script>

<script>
// âœ… ê´‘ê³  ì„±ê³¼ í˜ì´ì§€ì—ì„œ í•„í„° ë³€ê²½ ì‹œ fetchData í˜¸ì¶œ
$(document).ready(function() {
    if (window.location.pathname === "/ads") {
        console.log("[DEBUG] ê´‘ê³  ì„±ê³¼ í˜ì´ì§€ í•„í„° ì´ë²¤íŠ¸ ì„¤ì •");
        
        // í•„í„° ë³€ê²½ ì‹œ fetchData í˜¸ì¶œ
        $("#accountFilter, #periodFilter, #startDate, #endDate").change(function() {
            console.log("[DEBUG] í•„í„° ë³€ê²½ ê°ì§€ - fetchData í˜¸ì¶œ");
            if (typeof fetchData === 'function') {
                fetchData(1);
            }
        });
        
        $("#applyDateFilter").click(function() {
            console.log("[DEBUG] í•„í„° ì ìš© ë²„íŠ¼ í´ë¦­ - fetchData í˜¸ì¶œ");
            if (typeof fetchData === 'function') {
                fetchData(1);
            }
        });
        
        // ì´ˆê¸° ë¡œë”©
        if (typeof fetchData === 'function') {
            fetchData(1);
        }
    }
});
</script>

</body>
</html>
