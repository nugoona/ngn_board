<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEP 5 - ADMAKE</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Fonts: Inter Tight (영문/숫자) + Pretendard (한글) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Lottie Player -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=1.4">

  <style>
    :root {
      --bg-primary: #09090B;
      --bg-secondary: #121215;
      --bg-card: #18181B;
      --bg-card-hover: #1f1f23;
      --bg-input: #0d0d0f;
      --border-default: #27272A;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-hover: rgba(255, 255, 255, 0.12);
      --border-focus: rgba(255, 255, 255, 0.2);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #52525b;
      --accent-blue: #3b82f6;
      --accent-emerald: #10b981;
      --accent-gold: #f59e0b;
      --accent-red: #ef4444;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-primary);
      font-family: 'Pretendard', 'Inter Tight', -apple-system, BlinkMacSystemFont, sans-serif;
      letter-spacing: -0.02em;
      height: 100vh;
      overflow: hidden;
      color: var(--text-primary);
    }

    /* ===== 전역 스크롤바 - Minimalist Style ===== */
    ::-webkit-scrollbar {
      width: 5px;
      height: 5px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-default);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #3f3f46;
    }

    ::-webkit-scrollbar-corner {
      background: transparent;
    }

    /* Firefox */
    * {
      scrollbar-width: thin;
      scrollbar-color: var(--border-default) transparent;
    }

    .font-inter {
      font-family: 'Inter Tight', sans-serif;
      letter-spacing: 0;
    }

    /* ===== 네비게이션 오버라이드 ===== */
    .nav-buttons {
      background: var(--bg-primary) !important;
      border-bottom: 1px solid var(--border-default) !important;
      height: 56px;
      flex-shrink: 0;
    }

    .nav-buttons .updated-at-text {
      color: var(--text-primary) !important;
      font-family: 'Inter Tight', sans-serif !important;
      font-weight: 700 !important;
      font-size: 14px !important;
      letter-spacing: 0.05em !important;
    }

    .hamburger-dropdown {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-default) !important;
    }

    .hamburger-dropdown a {
      color: var(--text-secondary) !important;
    }

    .hamburger-dropdown a:hover {
      background: var(--bg-card) !important;
      color: var(--text-primary) !important;
    }

    /* ===== Progress Bar (Refined Minimal Style) ===== */
    .admake-progress-bar {
      position: sticky;
      top: 56px;
      z-index: 100;
      background: linear-gradient(180deg, #0A0A0B 0%, #09090B 100%);
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      padding: 28px 40px;
      flex-shrink: 0;
    }

    .admake-progress-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0;
      max-width: 860px;
      margin: 0 auto;
    }

    .admake-progress-step {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 12px 16px;
      border-radius: 8px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      background: transparent;
      min-width: 90px;
    }

    .admake-progress-step .step-icon {
      display: none;
      width: 18px;
      height: 18px;
    }

    .admake-progress-step .step-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 10px;
      font-weight: 700;
      color: #3F3F46;
      letter-spacing: 0.08em;
      transition: all 0.4s ease;
      text-transform: uppercase;
    }

    .admake-progress-step .step-label {
      font-family: 'Pretendard', sans-serif;
      font-size: 12px;
      font-weight: 500;
      color: #3F3F46;
      white-space: nowrap;
      transition: all 0.4s ease;
    }

    /* ===== Completed State ===== */
    .admake-progress-step.completed {
      background: rgba(16, 185, 129, 0.12);
      border: 1px solid rgba(16, 185, 129, 0.25);
    }

    .admake-progress-step.completed .step-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      color: #34D399;
    }

    .admake-progress-step.completed .step-icon i {
      width: 16px;
      height: 16px;
      stroke-width: 2.5;
    }

    .admake-progress-step.completed .step-number {
      display: none;
    }

    .admake-progress-step.completed .step-label {
      color: #6EE7B7;
      font-weight: 500;
    }

    /* ===== Active State ===== */
    .admake-progress-step.active {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.1),
                  0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .admake-progress-step.active .step-number {
      color: #18181B;
      font-weight: 800;
    }

    .admake-progress-step.active .step-label {
      color: #09090B;
      font-weight: 600;
    }

    /* ===== Pending State ===== */
    .admake-progress-step:not(.completed):not(.active) {
      background: transparent;
      border: 1px dashed #27272A;
    }

    .admake-progress-step:not(.completed):not(.active) .step-number {
      color: #52525B;
    }

    .admake-progress-step:not(.completed):not(.active) .step-label {
      color: #52525B;
    }

    /* ===== Connector Lines ===== */
    .admake-progress-connector {
      display: flex;
      align-items: center;
      padding: 0 6px;
      transition: all 0.4s ease;
    }

    .admake-progress-connector-line {
      width: 28px;
      height: 2px;
      background: #27272A;
      border-radius: 1px;
      transition: all 0.4s ease;
    }

    .admake-progress-connector.completed .admake-progress-connector-line {
      background: linear-gradient(90deg, #10B981 0%, #34D399 100%);
    }

    /* ===== 메인 레이아웃 ===== */
    .admake-main-wrapper {
      display: flex;
      flex-direction: column;
      padding-top: 65px;
      height: calc(100vh - 56px - 105px - 72px);
      overflow: hidden;
    }

    .admake-main-content {
      flex: 1;
      overflow-y: auto;
      padding: 24px 32px 32px;
    }

    .admake-content-inner {
      max-width: 900px;
      margin: 0 auto;
    }

    /* ===== 섹션 스타일 ===== */
    .admake-section {
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 12px;
      margin-bottom: 20px;
      padding: 20px;
    }

    .admake-section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .admake-section-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 11px;
      font-weight: 700;
      color: var(--accent-blue);
      background: rgba(59, 130, 246, 0.1);
      padding: 4px 10px;
      border-radius: 4px;
      letter-spacing: 0.08em;
    }

    .admake-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .admake-section-subtitle {
      margin-left: auto;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ===== 01 최종 확인 섹션 ===== */
    .review-ad-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .review-ad-item {
      display: flex;
      align-items: center;
      gap: 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 12px 16px;
    }

    .review-ad-thumb {
      width: 56px;
      height: 56px;
      border-radius: 6px;
      overflow: hidden;
      background: var(--bg-input);
      flex-shrink: 0;
    }

    .review-ad-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .review-ad-info {
      flex: 1;
      min-width: 0;
    }

    .review-ad-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .review-ad-format {
      font-size: 12px;
      color: var(--text-muted);
    }

    .review-settings-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .review-card {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 16px;
    }

    .review-card-title {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .review-card-title i {
      width: 14px;
      height: 14px;
    }

    .review-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-subtle);
    }

    .review-row:last-child {
      border-bottom: none;
    }

    .review-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .review-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .review-value.highlight {
      color: var(--accent-emerald);
    }

    .review-value.warning {
      color: var(--accent-gold);
    }

    .review-exposure-banner {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .review-exposure-banner.active {
      border-color: var(--accent-emerald);
      background: rgba(16, 185, 129, 0.05);
    }

    .review-exposure-banner.paused {
      border-color: var(--accent-gold);
      background: rgba(245, 158, 11, 0.05);
    }

    .review-exposure-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .review-exposure-banner.active .review-exposure-icon {
      background: rgba(16, 185, 129, 0.15);
      color: var(--accent-emerald);
    }

    .review-exposure-banner.paused .review-exposure-icon {
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent-gold);
    }

    .review-exposure-text {
      flex: 1;
    }

    .review-exposure-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .review-exposure-desc {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* ===== 전송 프로그레스 섹션 ===== */
    .publish-progress-section {
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 8px;
      padding: 20px;
      display: none;
    }

    .publish-progress-section.active {
      display: block;
    }

    .progress-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .progress-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .progress-count {
      font-family: 'Inter Tight', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-blue);
    }

    .progress-bar-container {
      width: 100%;
      height: 4px;
      background: var(--border-default);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #10B981 0%, #34D399 100%);
      border-radius: 2px;
      transition: width 0.3s ease;
      width: 0%;
    }

    .progress-status {
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* ===== 결과 리스트 ===== */
    .result-list {
      display: none;
      flex-direction: column;
      gap: 8px;
    }

    .result-list.active {
      display: flex;
    }

    .result-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: 8px;
    }

    .result-item.result-success {
      border-left: 3px solid var(--accent-emerald);
    }

    .result-item.result-error {
      border-left: 3px solid var(--accent-red);
    }

    .result-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .result-icon i {
      width: 18px;
      height: 18px;
    }

    .result-success .result-icon {
      color: var(--accent-emerald);
    }

    .result-error .result-icon {
      color: var(--accent-red);
    }

    .result-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }

    .result-status {
      font-size: 12px;
      font-weight: 500;
    }

    .result-success .result-status {
      color: var(--accent-emerald);
    }

    .result-error .result-status {
      color: var(--accent-red);
    }

    .result-link {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: var(--accent-blue);
      text-decoration: none;
      padding: 6px 12px;
      background: rgba(59, 130, 246, 0.1);
      border-radius: 4px;
      transition: all 0.2s;
    }

    .result-link:hover {
      background: rgba(59, 130, 246, 0.2);
    }

    .result-link i {
      width: 14px;
      height: 14px;
    }

    .result-error-msg {
      font-size: 11px;
      color: var(--accent-red);
      opacity: 0.9;
      max-width: 250px;
    }

    /* ===== 하단 액션 바 ===== */
    .admake-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 72px;
      background: linear-gradient(180deg, rgba(18, 18, 21, 0.95) 0%, var(--bg-secondary) 100%);
      border-top: 1px solid var(--border-default);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      z-index: 1000;
      backdrop-filter: blur(12px);
    }

    .admake-action-left {
      font-family: 'Inter Tight', sans-serif;
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.06em;
      font-weight: 500;
    }

    .admake-action-buttons {
      display: flex;
      gap: 10px;
    }

    .admake-btn {
      font-family: 'Inter Tight', sans-serif;
      padding: 12px 28px;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.02em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.25s;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .admake-btn i {
      width: 16px;
      height: 16px;
    }

    .admake-btn-secondary {
      background: linear-gradient(135deg, #27272A 0%, #1f1f23 100%);
      color: var(--text-secondary);
      border: 1px solid var(--border-default);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .admake-btn-secondary:hover {
      background: linear-gradient(135deg, #3f3f46 0%, #27272A 100%);
      border-color: var(--border-hover);
      color: var(--text-primary);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.08);
    }

    .admake-btn-primary {
      background: linear-gradient(135deg, #f5f5f5 0%, #e5e5e5 100%);
      color: #1a1a1a;
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    .admake-btn-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 1);
      transform: translateY(-1px);
    }

    .admake-btn-primary:disabled {
      opacity: 0.25;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* 전송 버튼 (Emerald) */
    .admake-btn-publish {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .admake-btn-publish:hover:not(:disabled) {
      background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
    }

    .admake-btn-publish:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* ===== 후속 액션 버튼 (전송 완료 후) ===== */
    .publish-action-buttons {
      display: none;
      gap: 12px;
    }

    .publish-action-buttons.active {
      display: flex;
    }

    .publish-btn-more {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .publish-btn-more:hover {
      background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
      box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
      transform: translateY(-1px);
    }

    .publish-btn-home {
      background: linear-gradient(135deg, #27272A 0%, #1f1f23 100%);
      color: var(--text-secondary);
      border: 1px solid var(--border-default);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .publish-btn-home:hover {
      background: linear-gradient(135deg, #3f3f46 0%, #27272A 100%);
      color: var(--text-primary);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    /* ===== 성공 애니메이션 오버레이 ===== */
    .success-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(9, 9, 11, 0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      flex-direction: column;
      gap: 20px;
    }

    .success-overlay.active {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .success-overlay lottie-player {
      width: 200px;
      height: 200px;
    }

    .success-message {
      font-size: 20px;
      font-weight: 600;
      color: var(--accent-emerald);
      text-align: center;
    }

    .success-submessage {
      font-size: 14px;
      color: var(--text-secondary);
      text-align: center;
    }

    /* ===== 커스텀 토스트 알림 ===== */
    .admake-toast-container {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }

    .admake-toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
      border-radius: 10px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(12px);
      pointer-events: auto;
      animation: toastSlideIn 0.3s ease;
      max-width: 400px;
    }

    .admake-toast.toast-out {
      animation: toastSlideOut 0.3s ease forwards;
    }

    @keyframes toastSlideIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes toastSlideOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }

    .admake-toast-icon { font-size: 18px; flex-shrink: 0; }
    .admake-toast-message { font-size: 13px; font-weight: 500; color: var(--text-primary); line-height: 1.4; }
    .admake-toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 4px; margin-left: auto; font-size: 16px; }
    .admake-toast-close:hover { color: var(--text-primary); }
    .admake-toast.toast-info { border-left: 3px solid var(--accent-blue); }
    .admake-toast.toast-success { border-left: 3px solid var(--accent-emerald); }
    .admake-toast.toast-warning { border-left: 3px solid var(--accent-gold); }
    .admake-toast.toast-error { border-left: 3px solid var(--accent-red); }

    /* ===== 숨김 클래스 ===== */
    .hidden { display: none !important; }

    /* ===== 반응형 ===== */
    @media (max-width: 768px) {
      .review-grid {
        grid-template-columns: 1fr;
      }

      .admake-action-bar {
        padding: 0 16px;
      }

      .admake-btn {
        padding: 10px 16px;
        font-size: 11px;
      }
    }
  </style>
</head>
<body>

<script>
  var userCompanyList = {{ session['company_names'] | tojson }};
  var currentUserId = "{{ session['user_id'] }}";
  var accountId = "{{ account_id }}";
</script>
<script src="{{ url_for('static', filename='js/mobile_detection.js') }}"></script>

<!-- 네비게이션 -->
<div class="nav-buttons">
  <div class="nav-left">
    <div id="updatedAtText" class="updated-at-text">ADMAKE</div>
  </div>
  <div class="nav-right">
    <div class="hamburger-menu-wrapper">
      <div class="hamburger-icon" id="hamburgerIcon">
        <div></div><div></div><div></div>
      </div>
      <div class="hamburger-dropdown" id="hamburgerDropdown">
        <a href="/">사이트 성과</a>
        <a href="{{ url_for('ads_page') }}">광고 성과</a>
        <a href="{{ url_for('trend_selection_page') }}">TREND</a>
        <a href="{{ url_for('auth.logout') }}">로그아웃</a>
      </div>
    </div>
  </div>
</div>

<!-- Progress Bar (Refined Minimal Style) -->
<div class="admake-progress-bar">
  <div class="admake-progress-steps">
    <div class="admake-progress-step completed">
      <span class="step-icon"><i data-lucide="check"></i></span>
      <span class="step-number font-inter">STEP 1</span>
      <span class="step-label">미디어 업로드</span>
    </div>
    <div class="admake-progress-connector completed">
      <span class="admake-progress-connector-line"></span>
    </div>
    <div class="admake-progress-step completed">
      <span class="step-icon"><i data-lucide="check"></i></span>
      <span class="step-number font-inter">STEP 2</span>
      <span class="step-label">가이드로 자르기</span>
    </div>
    <div class="admake-progress-connector completed">
      <span class="admake-progress-connector-line"></span>
    </div>
    <div class="admake-progress-step completed">
      <span class="step-icon"><i data-lucide="check"></i></span>
      <span class="step-number font-inter">STEP 3</span>
      <span class="step-label">광고 생성</span>
    </div>
    <div class="admake-progress-connector completed">
      <span class="admake-progress-connector-line"></span>
    </div>
    <div class="admake-progress-step completed">
      <span class="step-icon"><i data-lucide="check"></i></span>
      <span class="step-number font-inter">STEP 4</span>
      <span class="step-label">사전 세팅</span>
    </div>
    <div class="admake-progress-connector completed">
      <span class="admake-progress-connector-line"></span>
    </div>
    <div class="admake-progress-step active">
      <span class="step-number font-inter">STEP 5</span>
      <span class="step-label">검토 및 생성</span>
    </div>
  </div>
</div>

<!-- 메인 컨텐츠 -->
<div class="admake-main-wrapper">
  <div class="admake-main-content">
    <div class="admake-content-inner">

      <!-- 01 최종 확인 섹션 -->
      <div class="admake-section" id="reviewSection">
        <div class="admake-section-header">
          <span class="admake-section-number font-inter">01</span>
          <span class="admake-section-title">최종 확인</span>
          <span class="admake-section-subtitle" id="reviewAdCount">총 0개의 광고</span>
        </div>

        <!-- 게시될 광고 목록 -->
        <div class="review-ad-list" id="reviewAdList">
          <!-- 동적으로 생성 -->
        </div>

        <!-- 전송 설정 + 예산 설정 -->
        <div class="review-settings-grid">
          <!-- 전송 설정 -->
          <div class="review-card">
            <div class="review-card-title">
              <i data-lucide="send"></i>
              전송 설정
            </div>
            <div class="review-row">
              <span class="review-label">유입 캠페인 복사</span>
              <span class="review-value" id="reviewCopyTraffic">-</span>
            </div>
            <div class="review-row">
              <span class="review-label">종료 일시</span>
              <span class="review-value" id="reviewEndDate">-</span>
            </div>
          </div>

          <!-- 예산 설정 -->
          <div class="review-card">
            <div class="review-card-title">
              <i data-lucide="wallet"></i>
              예산 설정
            </div>
            <div class="review-row">
              <span class="review-label">전환 캠페인</span>
              <span class="review-value" id="reviewConvBudget">-</span>
            </div>
            <div class="review-row">
              <span class="review-label">유입 캠페인</span>
              <span class="review-value" id="reviewTrafficBudget">-</span>
            </div>
          </div>
        </div>

        <!-- 노출 상태 배너 -->
        <div class="review-exposure-banner" id="reviewExposureBanner">
          <div class="review-exposure-icon">
            <i data-lucide="eye" style="width: 20px; height: 20px;"></i>
          </div>
          <div class="review-exposure-text">
            <div class="review-exposure-title" id="reviewExposureTitle">-</div>
            <div class="review-exposure-desc" id="reviewExposureDesc">-</div>
          </div>
        </div>
      </div>

      <!-- 전송 프로그레스 섹션 -->
      <div class="admake-section">
        <div class="admake-section-header">
          <span class="admake-section-number font-inter">02</span>
          <span class="admake-section-title">전송 상태</span>
        </div>

        <div class="publish-progress-section" id="progressSection">
          <div class="progress-header">
            <span class="progress-title">광고 전송 중</span>
            <span class="progress-count" id="progressCount">(0/0)</span>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progressBarFill"></div>
          </div>
          <div class="progress-status" id="progressStatus">대기 중...</div>
        </div>

        <div class="result-list" id="resultList">
          <!-- 동적으로 생성 -->
        </div>

        <div id="readyMessage" style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
          <i data-lucide="send" style="width: 32px; height: 32px; margin-bottom: 12px; opacity: 0.5;"></i>
          <p style="margin: 0; font-size: 14px;">[광고 전송] 버튼을 클릭하여<br>Meta에 광고를 게시하세요</p>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- 하단 액션 바 -->
<div class="admake-action-bar">
  <div class="admake-action-left font-inter">STEP 5 OF 5</div>
  <div class="admake-action-buttons" id="prePublishButtons">
    <button class="admake-btn admake-btn-secondary" id="backBtn">
      <i data-lucide="arrow-left"></i> BACK
    </button>
    <button class="admake-btn admake-btn-publish" id="publishBtn">
      <i data-lucide="send"></i> 광고 전송
    </button>
  </div>
  <div class="publish-action-buttons" id="postPublishButtons">
    <button class="admake-btn publish-btn-more" id="moreAdsBtn">
      <i data-lucide="plus"></i> 광고 더 만들기
    </button>
    <button class="admake-btn publish-btn-home" id="backHomeBtn">
      <i data-lucide="home"></i> 브릿지 페이지로
    </button>
  </div>
</div>

<!-- 성공 애니메이션 오버레이 -->
<div class="success-overlay" id="successOverlay">
  <lottie-player
    src="https://assets10.lottiefiles.com/packages/lf20_jbrw3hcz.json"
    background="transparent"
    speed="1"
    style="width: 200px; height: 200px;"
    autoplay
  ></lottie-player>
  <div class="success-message">전송 완료!</div>
  <div class="success-submessage">모든 광고가 성공적으로 게시되었습니다</div>
</div>

<!-- 토스트 컨테이너 -->
<div class="admake-toast-container" id="toastContainer"></div>

<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/common_ui.js') }}"></script>

<script>
// ===== 커스텀 토스트 알림 시스템 =====
function showToast(message, type = 'info', duration = 3500) {
  const container = document.getElementById('toastContainer');
  if (!container) return;

  const toast = document.createElement('div');
  toast.className = `admake-toast toast-${type}`;
  const icons = { info: 'i', success: '✓', warning: '⚠', error: '✕' };

  toast.innerHTML = `
    <span class="admake-toast-icon">${icons[type] || icons.info}</span>
    <span class="admake-toast-message">${message}</span>
    <button class="admake-toast-close" onclick="this.parentElement.remove()">×</button>
  `;

  container.appendChild(toast);
  setTimeout(() => {
    toast.classList.add('toast-out');
    setTimeout(() => toast.remove(), 300);
  }, duration);
}

// ===== 상태 관리 =====
let step3Data = null;
let step4Data = null;
let mediaItems = [];
let publishResults = [];
let isPublishing = false;
let pendingAds = [];    // Flask Session에서 로드
let accountInfo = null; // 계정 정보 (UTM, pixel_id 등)

console.log('[STEP5] 페이지 초기화 시작');

// ===== IndexedDB에서 File 객체 가져오기 =====
async function getFileFromIndexedDB(mediaId) {
  return new Promise((resolve, reject) => {
    if (!('indexedDB' in window)) {
      reject(new Error('IndexedDB를 지원하지 않습니다'));
      return;
    }

    const dbName = 'admake_files';
    const request = indexedDB.open(dbName, 1);

    request.onsuccess = (event) => {
      const db = event.target.result;
      const transaction = db.transaction(['files'], 'readonly');
      const store = transaction.objectStore('files');
      const getRequest = store.get(mediaId);

      getRequest.onsuccess = () => {
        if (getRequest.result && getRequest.result.file) {
          resolve(getRequest.result.file);
        } else {
          reject(new Error('파일을 찾을 수 없습니다'));
        }
      };

      getRequest.onerror = () => reject(getRequest.error);
    };

    request.onerror = () => reject(request.error);
  });
}

// ===== 데이터 로드 =====
async function loadAllData() {
  console.log('[STEP5] 데이터 로드 시작');

  // 1. Flask Session에서 pending_ads 로드
  await loadPendingAds();

  // 2. 계정 정보 로드 (UTM, pixel_id)
  await loadAccountInfo();

  // Step 4 데이터 로드
  const step4Raw = sessionStorage.getItem('admake_step4_state');
  if (step4Raw) {
    step4Data = JSON.parse(step4Raw);
    console.log('[STEP5] Step 4 데이터 로드:', step4Data);
  }

  // Step 3 데이터 로드 (이전 버전 호환)
  const step3Raw = sessionStorage.getItem('admake_step3_state');
  if (step3Raw) {
    step3Data = JSON.parse(step3Raw);
    console.log('[STEP5] Step 3 데이터 로드:', step3Data);
  }

  // 미디어 아이템 구성 (pending_ads 또는 sessionStorage)
  if (pendingAds.length > 0) {
    // pending_ads 사용
    console.log('[STEP5] pending_ads 사용:', pendingAds.length);
    // pending_ads에서 썸네일 정보 추출
    mediaItems = pendingAds.map(ad => ({
      id: ad.ad_id,
      adName: ad.ad_name,
      mediaType: ad.media_type,
      hash: ad.image_hash,
      videoId: ad.video_id,
      thumbnailUrl: ad.thumbnail_url,
      previewUrl: ad.thumbnail_url
    }));
  } else if (step3Data) {
    // 이전 버전 호환: sessionStorage 사용
    const uploadedRaw = sessionStorage.getItem('admake_uploaded_results');
    if (uploadedRaw) {
      const uploaded = JSON.parse(uploadedRaw);
      console.log('[STEP5] 업로드된 미디어 로드:', uploaded);

      if (step3Data.selectedMediaIds) {
        for (const mediaId of step3Data.selectedMediaIds) {
          const uploadedItem = uploaded.find(u => u.id === mediaId);
          if (uploadedItem) {
            let previewUrl = null;
            try {
              const file = await getFileFromIndexedDB(mediaId);
              previewUrl = URL.createObjectURL(file);
            } catch (e) {
              console.warn(`[STEP5] ${mediaId}: 파일 로드 실패`);
            }

            mediaItems.push({
              id: mediaId,
              mediaType: uploadedItem.type,
              hash: uploadedItem.hash,
              videoId: uploadedItem.video_id,
              thumbnailUrl: uploadedItem.thumbnail_url || uploadedItem.thumbnailUrl,
              previewUrl: previewUrl || uploadedItem.thumbnail_url
            });
          }
        }
      }
    }
  }

  console.log('[STEP5] 최종 미디어 아이템:', mediaItems.length);
  renderReview();
}

// ===== pending_ads 로드 =====
async function loadPendingAds() {
  try {
    const response = await fetch(`/dashboard/get_pending_ads?account_id=${accountId}`, {
      credentials: 'include'
    });
    const result = await response.json();

    if (result.status === 'success' && result.pending_ads) {
      pendingAds = result.pending_ads;
      console.log('[STEP5] pending_ads 로드:', pendingAds.length);
    }
  } catch (error) {
    console.error('[STEP5] pending_ads 로드 오류:', error);
  }
}

// ===== 계정 정보 로드 =====
async function loadAccountInfo() {
  try {
    const response = await fetch(`/dashboard/get_account_info?account_id=${accountId}`, {
      credentials: 'include'
    });
    const result = await response.json();

    if (result.status === 'success') {
      accountInfo = result;
      console.log('[STEP5] 계정 정보 로드:', accountInfo);
    }
  } catch (error) {
    console.error('[STEP5] 계정 정보 로드 오류:', error);
  }
}

// ===== 최종 확인 렌더링 =====
function renderReview() {
  const displayItems = pendingAds.length > 0 ? pendingAds : mediaItems;

  // 1. 광고 목록 렌더링
  const adList = document.getElementById('reviewAdList');
  adList.innerHTML = displayItems.map((item, index) => {
    const thumbUrl = item.thumbnail_url || item.thumbnailUrl || item.previewUrl;
    const mediaType = item.media_type || item.mediaType;
    const adName = item.ad_name || item.adName || `광고 ${index + 1}`;

    // 형식 텍스트
    let formatText = '단일 이미지';
    if (item.is_carousel) {
      formatText = '캐러셀';
    } else if (mediaType === 'video') {
      formatText = '단일 비디오';
    }

    return `
      <div class="review-ad-item">
        <div class="review-ad-thumb">
          ${thumbUrl
            ? `<img src="${thumbUrl}" alt="썸네일" onerror="this.style.display='none'">`
            : `<div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;color:var(--text-muted);"><i data-lucide="image" style="width:20px;height:20px;"></i></div>`
          }
        </div>
        <div class="review-ad-info">
          <div class="review-ad-name">${adName}</div>
          <div class="review-ad-format">${formatText}</div>
        </div>
      </div>
    `;
  }).join('');

  // 광고 개수 업데이트
  document.getElementById('reviewAdCount').textContent = `총 ${displayItems.length}개의 광고`;

  // 2. 전송 설정
  // 유입 캠페인 복사 여부
  const copyTraffic = step4Data?.copyToTraffic || false;
  const copyEl = document.getElementById('reviewCopyTraffic');
  if (copyEl) {
    copyEl.textContent = copyTraffic ? '복사함' : '복사 안 함';
    copyEl.className = `review-value ${copyTraffic ? 'highlight' : ''}`;
  }

  // 종료 일시
  const endDateEl = document.getElementById('reviewEndDate');
  if (endDateEl) {
    if (step4Data?.endDateSetting === 'set_end' && step4Data.endDate) {
      endDateEl.textContent = `${step4Data.endDate} ${step4Data.endTime || ''}`;
    } else {
      endDateEl.textContent = '기간 제한 없음';
    }
  }

  // 3. 예산 설정 (Step 4에서 가져오기)
  const convBudget = step4Data?.budgetData?.conv?.currentBudget;
  const trafficBudget = step4Data?.budgetData?.traffic?.currentBudget;
  const convActive = step4Data?.budgetData?.conv?.isActive !== false;
  const trafficActive = step4Data?.budgetData?.traffic?.isActive !== false;

  const convBudgetEl = document.getElementById('reviewConvBudget');
  if (convBudgetEl) {
    if (convBudget) {
      const formatted = convBudget.toLocaleString('ko-KR');
      const status = convActive ? '활성화' : '비활성화';
      const color = convActive ? 'var(--accent-emerald)' : 'var(--text-muted)';
      convBudgetEl.innerHTML = `${formatted}원/일 <span style="color:${color};font-size:11px;margin-left:4px;">(${status})</span>`;
    } else {
      convBudgetEl.textContent = '-';
    }
  }

  const trafficBudgetEl = document.getElementById('reviewTrafficBudget');
  if (trafficBudgetEl) {
    if (trafficBudget) {
      const formatted = trafficBudget.toLocaleString('ko-KR');
      const status = trafficActive ? '활성화' : '비활성화';
      const color = trafficActive ? 'var(--accent-emerald)' : 'var(--text-muted)';
      trafficBudgetEl.innerHTML = `${formatted}원/일 <span style="color:${color};font-size:11px;margin-left:4px;">(${status})</span>`;
    } else {
      trafficBudgetEl.textContent = '-';
    }
  }

  // 4. 노출 상태 배너
  const banner = document.getElementById('reviewExposureBanner');
  const titleEl = document.getElementById('reviewExposureTitle');
  const descEl = document.getElementById('reviewExposureDesc');

  const willExpose = convActive || trafficActive;

  if (banner && titleEl && descEl) {
    if (willExpose) {
      banner.className = 'review-exposure-banner active';
      titleEl.textContent = '광고 전송 시 바로 노출됩니다';
      descEl.textContent = '활성화된 캠페인에 광고가 게시되어 즉시 노출이 시작됩니다.';
    } else {
      banner.className = 'review-exposure-banner paused';
      titleEl.textContent = '광고만 게시되고 노출되지 않습니다';
      descEl.textContent = '모든 캠페인이 비활성화 상태입니다. 광고는 게시되지만 노출되지 않습니다.';
    }
  }

  // Lucide 아이콘 초기화
  lucide.createIcons();
}

// ===== 광고 전송 =====
async function publishAds() {
  if (isPublishing) return;

  // pending_ads 또는 step3Data가 있어야 전송 가능
  if (pendingAds.length === 0 && (!step3Data || mediaItems.length === 0)) {
    showToast('전송할 데이터가 없습니다.', 'error');
    return;
  }

  isPublishing = true;
  publishResults = [];

  // UI 상태 전환
  document.getElementById('readyMessage').style.display = 'none';
  document.getElementById('progressSection').classList.add('active');
  document.getElementById('publishBtn').disabled = true;

  try {
    // Step 4 설정 추출
    const copyToTraffic = step4Data?.copyToTraffic || false;
    const convActive = step4Data?.budgetData?.conv?.isActive !== false; // 기본값 true
    const trafficActive = step4Data?.budgetData?.traffic?.isActive || false;

    // 종료 날짜 설정
    let endTime = null;
    if (step4Data?.endDateSetting === 'set_end' && step4Data.endDate) {
      // ISO 8601 형식으로 변환 (Meta API 요구사항)
      const dateStr = step4Data.endDate;
      const timeStr = step4Data.endTime || '23:59';
      endTime = `${dateStr}T${timeStr}:00+09:00`;  // KST timezone
    }

    // UTM 파라미터 (계정 정보에서)
    const utmParams = accountInfo?.utm_params || '';

    // Pixel ID (계정 정보에서)
    const pixelId = accountInfo?.pixel_id || '';

    // 전송할 광고 데이터 구성
    let adsToPublish = [];

    if (pendingAds.length > 0) {
      // pending_ads 사용 (v1.0 방식)
      adsToPublish = pendingAds.map(ad => ({
        name: ad.ad_name,
        media_type: ad.media_type,
        message: ad.primary_text || '',
        link: ad.url || '',
        headline: ad.headline || '',
        description: ad.description || '',
        cta_type: ad.cta_type || 'SHOP_NOW',
        image_hash: ad.image_hash,
        video_id: ad.video_id,
        thumbnail_url: ad.thumbnail_url,
        is_carousel: ad.is_carousel || false,
        cards: ad.cards || []
      }));
    } else if (step3Data) {
      // 이전 방식 (sessionStorage 기반)
      const masterValues = step3Data.masterValues || {};

      if (step3Data.adType === 'slide') {
        // 캐러셀: 하나의 광고로 전송
        const cards = mediaItems.map((item, idx) => {
          const locks = step3Data.cardLocks?.[item.id] || {};
          const values = step3Data.cardValues?.[item.id] || {};

          const cardData = {
            link: locks.url ? masterValues.url : (values.url || masterValues.url),
            name: locks.headline ? masterValues.headline : (values.headline || masterValues.headline),
            description: locks.description ? masterValues.description : (values.description || masterValues.description)
          };

          if (item.mediaType === 'video') {
            cardData.video_id = item.videoId;
            if (item.thumbnailUrl) cardData.thumbnail_url = item.thumbnailUrl;
          } else {
            cardData.image_hash = item.hash;
          }

          return cardData;
        });

        adsToPublish.push({
          name: masterValues.adName || 'AD_CAROUSEL',
          is_carousel: true,
          cards: cards,
          message: masterValues.primaryText || '',
          link: masterValues.url || '',
          cta_type: masterValues.cta || 'SHOP_NOW'
        });
      } else {
        // 단일 이미지/비디오: 각각 별도 광고
        mediaItems.forEach((item, idx) => {
          const adData = {
            name: item.adName || `${masterValues.adName || 'AD'}_${String(idx + 1).padStart(2, '0')}`,
            media_type: item.mediaType,
            message: masterValues.primaryText || '',
            link: masterValues.url || '',
            headline: masterValues.headline || '',
            description: masterValues.description || '',
            cta_type: masterValues.cta || 'SHOP_NOW'
          };

          if (item.mediaType === 'video') {
            adData.video_id = item.videoId;
            if (item.thumbnailUrl) adData.thumbnail_url = item.thumbnailUrl;
          } else {
            adData.image_hash = item.hash;
          }

          adsToPublish.push(adData);
        });
      }
    }

    console.log('[STEP5] 전송할 광고:', adsToPublish);
    console.log('[STEP5] 설정 - copyToTraffic:', copyToTraffic, 'convActive:', convActive, 'trafficActive:', trafficActive);
    console.log('[STEP5] UTM:', utmParams, 'Pixel:', pixelId);

    // 배치 전송 API 호출 (Step 4 설정 포함)
    const response = await fetch('/dashboard/publish_ads_batch', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        account_id: accountId,
        ads: adsToPublish,
        // Step 4 설정 추가
        copy_to_traffic: copyToTraffic,
        conv_active: convActive,
        traffic_active: trafficActive,
        end_time: endTime,
        utm_params: utmParams,
        pixel_id: pixelId
      })
    });

    const result = await response.json();
    console.log('[STEP5] 전송 결과:', result);

    if (result.status === 'success') {
      publishResults = result.results || [];
      renderResults();

      // 전송 성공 후 pending_ads 클리어
      await clearPendingAds();

      // 모든 성공 시 애니메이션 표시
      if (result.fail_count === 0) {
        showSuccessAnimation();
      } else {
        showToast(`${result.success_count}개 성공, ${result.fail_count}개 실패`, 'warning');
      }
    } else {
      throw new Error(result.message || '전송 실패');
    }

  } catch (error) {
    console.error('[STEP5] 전송 오류:', error);
    showToast(`전송 오류: ${error.message}`, 'error');

    // 에러 결과 표시
    publishResults = [{
      name: 'Error',
      success: false,
      error: error.message
    }];
    renderResults();
  }

  // UI 상태 전환 (완료)
  isPublishing = false;
  document.getElementById('progressSection').classList.remove('active');
  document.getElementById('prePublishButtons').style.display = 'none';
  document.getElementById('postPublishButtons').classList.add('active');
}

// ===== pending_ads 클리어 =====
async function clearPendingAds() {
  try {
    await fetch(`/dashboard/clear_pending_ads?account_id=${accountId}`, {
      method: 'DELETE',
      credentials: 'include'
    });
    console.log('[STEP5] pending_ads 클리어 완료');
  } catch (error) {
    console.error('[STEP5] pending_ads 클리어 오류:', error);
  }
}

// ===== 프로그레스 업데이트 =====
function updateProgress(current, total, status) {
  const percent = Math.round((current / total) * 100);
  document.getElementById('progressCount').textContent = `(${current}/${total})`;
  document.getElementById('progressBarFill').style.width = `${percent}%`;
  document.getElementById('progressStatus').textContent = status;
}

// ===== 결과 렌더링 =====
function renderResults() {
  const resultList = document.getElementById('resultList');
  resultList.innerHTML = '';
  resultList.classList.add('active');

  publishResults.forEach(result => {
    const div = document.createElement('div');
    div.className = `result-item ${result.success ? 'result-success' : 'result-error'}`;

    if (result.success) {
      div.innerHTML = `
        <span class="result-icon"><i data-lucide="check-circle"></i></span>
        <span class="result-name">${result.name}</span>
        <span class="result-status">전송 완료</span>
        ${result.preview_link ? `
          <a href="${result.preview_link}" class="result-link" target="_blank">
            <i data-lucide="external-link"></i> 메타에서 확인
          </a>
        ` : ''}
      `;
    } else {
      div.innerHTML = `
        <span class="result-icon"><i data-lucide="alert-circle"></i></span>
        <span class="result-name">${result.name}</span>
        <span class="result-status">전송 실패</span>
        <span class="result-error-msg">${result.error || '알 수 없는 오류'}</span>
      `;
    }

    resultList.appendChild(div);
  });

  lucide.createIcons();
}

// ===== 성공 애니메이션 =====
function showSuccessAnimation() {
  const overlay = document.getElementById('successOverlay');
  overlay.classList.add('active');

  // 2.5초 후 자동 숨김
  setTimeout(() => {
    overlay.classList.remove('active');
    showToast('모든 광고가 성공적으로 전송되었습니다!', 'success');
  }, 2500);
}

// ===== Smart Reset =====
function smartReset() {
  // Step 3~4 데이터만 삭제
  sessionStorage.removeItem('admake_step3_state');
  sessionStorage.removeItem('admake_step4_state');

  // Step 1~2 데이터 유지
  // admake_step1_state, IndexedDB.admake_files 유지

  showToast('기존 소재를 유지한 채 Step 1으로 이동합니다.', 'info', 2000);

  setTimeout(() => {
    window.location.href = `/admake/create?account_id=${encodeURIComponent(accountId)}&preserve=true`;
  }, 1500);
}

// ===== 이벤트 핸들러 =====
function handleBackButton() {
  console.log('[STEP5] 이전 버튼 클릭');
  window.location.href = `/admake/manage?account_id=${encodeURIComponent(accountId)}`;
}

function handleMoreAds() {
  console.log('[STEP5] 광고 더 만들기 클릭');
  smartReset();
}

function handleBackHome() {
  console.log('[STEP5] 브릿지 페이지로 클릭');
  window.location.href = `/admake?account_id=${encodeURIComponent(accountId)}`;
}

// ===== 초기화 =====
document.addEventListener('DOMContentLoaded', async () => {
  console.log('[STEP5] DOMContentLoaded');

  // Lucide 아이콘 초기화
  lucide.createIcons();

  // 데이터 로드
  await loadAllData();

  // 이벤트 리스너 등록
  document.getElementById('backBtn').addEventListener('click', handleBackButton);
  document.getElementById('publishBtn').addEventListener('click', publishAds);
  document.getElementById('moreAdsBtn').addEventListener('click', handleMoreAds);
  document.getElementById('backHomeBtn').addEventListener('click', handleBackHome);

  console.log('[STEP5] 초기화 완료');
});
</script>

</body>
</html>
