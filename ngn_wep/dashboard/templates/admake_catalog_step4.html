<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>STEP 4 - ì¹´íƒˆë¡œê·¸ ê´‘ê³ </title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}?v=1.4">

  <style>
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #111111;
      --bg-card: #161616;
      --bg-card-hover: #1a1a1a;
      --bg-input: #0d0d0d;
      --border-subtle: rgba(255, 255, 255, 0.06);
      --border-hover: rgba(255, 255, 255, 0.12);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-blue: #3b82f6;
      --accent-emerald: #10b981;
      --accent-violet: #8b5cf6;
      --accent-amber: #f59e0b;
      --accent-red: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg-primary);
      font-family: 'Pretendard', 'Inter Tight', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .font-inter { font-family: 'Inter Tight', sans-serif; }

    /* ===== ë„¤ë¹„ê²Œì´ì…˜ ===== */
    .nav-buttons {
      background: var(--bg-primary) !important;
      border-bottom: 1px solid var(--border-subtle) !important;
    }
    .nav-buttons .updated-at-text {
      color: var(--text-primary) !important;
      font-family: 'Inter Tight', sans-serif !important;
      font-weight: 700 !important;
    }
    .hamburger-icon div { background: var(--text-primary) !important; }
    .hamburger-dropdown {
      background: var(--bg-secondary) !important;
      border: 1px solid var(--border-subtle) !important;
    }
    .hamburger-dropdown a { color: var(--text-secondary) !important; }
    .hamburger-dropdown a:hover {
      background: var(--bg-card) !important;
      color: var(--text-primary) !important;
    }

    /* ===== Progress Bar ===== */
    .admake-progress-bar {
      position: sticky;
      top: 56px;
      z-index: 100;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, rgba(17, 17, 17, 0.95) 100%);
      border-bottom: 1px solid var(--border-subtle);
      padding: 20px 40px 18px;
      backdrop-filter: blur(12px);
    }

    .admake-progress-steps {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      max-width: 700px;
      margin: 0 auto;
    }

    .admake-progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 10px 20px;
      border-radius: 8px;
      border: 1px solid transparent;
    }

    .admake-progress-step .step-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-muted);
    }

    .admake-progress-step .step-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      opacity: 0.7;
    }

    .admake-progress-step.active {
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .admake-progress-step.active .step-number {
      font-size: 14px;
      color: #1a1a1a;
    }

    .admake-progress-step.active .step-label {
      font-size: 13px;
      font-weight: 600;
      color: #2a2a2a;
      opacity: 1;
    }

    .admake-progress-step.completed {
      background: rgba(16, 185, 129, 0.08);
      border-color: rgba(16, 185, 129, 0.15);
    }

    .admake-progress-step.completed .step-number,
    .admake-progress-step.completed .step-label {
      color: var(--accent-emerald);
      opacity: 1;
    }

    .admake-progress-connector {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 4px;
    }

    .admake-progress-connector::before,
    .admake-progress-connector::after {
      content: '';
      width: 12px;
      height: 1px;
      background: var(--border-subtle);
    }

    .admake-progress-connector-dot {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--text-muted);
      opacity: 0.4;
    }

    .admake-progress-connector.completed::before,
    .admake-progress-connector.completed::after {
      background: var(--accent-emerald);
    }

    .admake-progress-connector.completed .admake-progress-connector-dot {
      background: var(--accent-emerald);
      opacity: 1;
    }

    /* ===== ë©”ì¸ ë ˆì´ì•„ì›ƒ ===== */
    .admake-wrapper {
      max-width: 900px;
      margin: 0 auto;
      padding: 65px 40px 120px;
    }

    /* ===== ì„¹ì…˜ í—¤ë” ===== */
    .admake-section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .admake-section-number {
      font-family: 'Inter Tight', sans-serif;
      font-size: 10px;
      font-weight: 800;
      color: var(--accent-violet);
      background: rgba(139, 92, 246, 0.08);
      border: 1px solid rgba(139, 92, 246, 0.15);
      padding: 5px 10px;
      border-radius: 4px;
      letter-spacing: 0.1em;
    }

    .admake-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* ===== ìš”ì•½ ì¹´ë“œ ===== */
    .summary-section {
      margin-bottom: 32px;
    }

    .summary-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      overflow: hidden;
    }

    .summary-card-header {
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.02);
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .summary-card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .summary-card-icon {
      font-size: 16px;
    }

    .summary-card-edit {
      font-size: 12px;
      color: var(--accent-violet);
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .summary-card-edit:hover {
      opacity: 0.8;
    }

    .summary-card-body {
      padding: 20px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 0;
    }

    .summary-row:not(:last-child) {
      border-bottom: 1px solid var(--border-subtle);
    }

    .summary-label {
      font-size: 13px;
      color: var(--text-muted);
    }

    .summary-value {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      text-align: right;
      max-width: 60%;
    }

    /* ===== ê´‘ê³  ì„¸íŠ¸ ì´ë¦„ ì…ë ¥ ===== */
    .adset-name-section {
      margin-bottom: 32px;
    }

    .input-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 10px;
      display: block;
    }

    .text-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .text-input:focus {
      outline: none;
      border-color: var(--accent-violet);
    }

    .text-input::placeholder {
      color: var(--text-muted);
    }

    /* ===== ì˜ˆì‚° ì„¤ì • ===== */
    .budget-section {
      margin-bottom: 32px;
    }

    .budget-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .budget-tab {
      flex: 1;
      padding: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .budget-tab:hover {
      background: var(--bg-card-hover);
    }

    .budget-tab.active {
      background: rgba(139, 92, 246, 0.08);
      border-color: rgba(139, 92, 246, 0.3);
    }

    .budget-tab-text {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .budget-tab.active .budget-tab-text {
      color: var(--accent-violet);
    }

    .budget-input-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .budget-input {
      flex: 1;
      padding: 14px 16px;
      background: var(--bg-input);
      border: 1px solid var(--border-subtle);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 16px;
      font-family: 'Inter Tight', sans-serif;
      font-weight: 600;
    }

    .budget-input:focus {
      outline: none;
      border-color: var(--accent-violet);
    }

    .budget-currency {
      font-size: 14px;
      color: var(--text-muted);
    }

    .budget-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 10px;
    }

    /* ===== ê²½ê³ /ì•ˆë‚´ ë°•ìŠ¤ ===== */
    .notice-box {
      padding: 16px;
      background: rgba(245, 158, 11, 0.08);
      border: 1px solid rgba(245, 158, 11, 0.15);
      border-radius: 12px;
      margin-bottom: 24px;
    }

    .notice-box-text {
      font-size: 13px;
      color: var(--accent-amber);
      line-height: 1.6;
    }

    /* ===== í•˜ë‹¨ ì•¡ì…˜ ë°” ===== */
    .admake-action-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, rgba(10, 10, 10, 0) 0%, var(--bg-primary) 20%);
      padding: 24px 40px;
      z-index: 100;
    }

    .admake-action-inner {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .admake-action-left {
      font-family: 'Inter Tight', sans-serif;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .admake-action-buttons {
      display: flex;
      gap: 12px;
    }

    .admake-btn {
      padding: 12px 28px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .admake-btn-secondary {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
    }

    .admake-btn-secondary:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
    }

    .admake-btn-primary {
      background: var(--accent-emerald);
      color: white;
    }

    .admake-btn-primary:hover {
      background: #059669;
    }

    .admake-btn-primary:disabled {
      background: var(--text-muted);
      cursor: not-allowed;
    }

    /* ===== ë¡œë”© ì˜¤ë²„ë ˆì´ ===== */
    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-content {
      text-align: center;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--border-subtle);
      border-top-color: var(--accent-violet);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-primary);
    }

    /* ===== ì„±ê³µ í™”ë©´ ===== */
    .success-screen {
      display: none;
      position: fixed;
      inset: 0;
      background: var(--bg-primary);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .success-screen.active {
      display: flex;
    }

    .success-content {
      text-align: center;
      max-width: 400px;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .success-icon svg {
      width: 40px;
      height: 40px;
      stroke: var(--accent-emerald);
      stroke-width: 2;
      fill: none;
    }

    .success-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
    }

    .success-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .success-id {
      font-family: 'Inter Tight', monospace;
      font-size: 12px;
      color: var(--text-muted);
      background: var(--bg-card);
      padding: 8px 16px;
      border-radius: 6px;
      margin-bottom: 32px;
      display: inline-block;
    }

    .success-btn {
      padding: 14px 32px;
      background: var(--accent-violet);
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }

    .success-btn:hover {
      background: #7c3aed;
    }
  </style>
</head>
<body>

<script>
  var userCompanyList = {{ session['company_names'] | tojson }};
  var currentUserId = "{{ session['user_id'] }}";
  var accountId = "{{ account_id }}";
</script>
<script src="{{ url_for('static', filename='js/mobile_detection.js') }}"></script>

<!-- ë„¤ë¹„ê²Œì´ì…˜ -->
<div class="nav-buttons">
  <div class="nav-left">
    <div id="updatedAtText" class="updated-at-text">AdCanvas</div>
  </div>
  <div class="nav-right">
    <div class="hamburger-menu-wrapper">
      <div class="hamburger-icon" id="hamburgerIcon">
        <div></div><div></div><div></div>
      </div>
      <div class="hamburger-dropdown" id="hamburgerDropdown">
        <a href="/">ì‚¬ì´íŠ¸ ì„±ê³¼</a>
        <a href="{{ url_for('ads_page') }}">ê´‘ê³  ì„±ê³¼</a>
        <a href="{{ url_for('admake_page') }}?account_id={{ account_id }}">AdCanvas</a>
        <a href="{{ url_for('auth.logout') }}">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>
  </div>
</div>

<!-- Progress Bar -->
<div class="admake-progress-bar">
  <div class="admake-progress-steps">
    <div class="admake-progress-step completed">
      <span class="step-number font-inter">01</span>
      <span class="step-label">ì œí’ˆ ì„¸íŠ¸</span>
    </div>
    <div class="admake-progress-connector completed">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step completed">
      <span class="step-number font-inter">02</span>
      <span class="step-label">íƒ€ê²ŸíŒ…</span>
    </div>
    <div class="admake-progress-connector completed">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step completed">
      <span class="step-number font-inter">03</span>
      <span class="step-label">ê´‘ê³  ë¬¸êµ¬</span>
    </div>
    <div class="admake-progress-connector completed">
      <div class="admake-progress-connector-dot"></div>
    </div>
    <div class="admake-progress-step active">
      <span class="step-number font-inter">04</span>
      <span class="step-label">ê²€í†  & ê²Œì‹œ</span>
    </div>
  </div>
</div>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<div class="admake-wrapper">
  <div class="admake-section-header">
    <span class="admake-section-number font-inter">04</span>
    <span class="admake-section-title">ê²€í†  & ê²Œì‹œ</span>
  </div>

  <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
  <div class="notice-box">
    <div class="notice-box-text">
      ğŸ’¡ ê´‘ê³ ëŠ” <strong>ì¼ì‹œì¤‘ì§€(PAUSED)</strong> ìƒíƒœë¡œ ìƒì„±ë©ë‹ˆë‹¤. ìƒì„± í›„ Meta ê´‘ê³  ê´€ë¦¬ìì—ì„œ ê²€í† í•˜ê³  í™œì„±í™”í•˜ì„¸ìš”.
    </div>
  </div>

  <!-- ì œí’ˆ ì„¸íŠ¸ ìš”ì•½ -->
  <div class="summary-section">
    <div class="summary-card">
      <div class="summary-card-header">
        <div class="summary-card-title">
          <span class="summary-card-icon">ğŸ“¦</span>
          <span>ì œí’ˆ ì„¸íŠ¸</span>
        </div>
        <span class="summary-card-edit" data-step="1">ìˆ˜ì •</span>
      </div>
      <div class="summary-card-body">
        <div class="summary-row">
          <span class="summary-label">ì„ íƒëœ ì„¸íŠ¸</span>
          <span class="summary-value" id="summaryProductSet">-</span>
        </div>
      </div>
    </div>
  </div>

  <!-- íƒ€ê²ŸíŒ… ìš”ì•½ -->
  <div class="summary-section">
    <div class="summary-card">
      <div class="summary-card-header">
        <div class="summary-card-title">
          <span class="summary-card-icon">ğŸ¯</span>
          <span>íƒ€ê²ŸíŒ…</span>
        </div>
        <span class="summary-card-edit" data-step="2">ìˆ˜ì •</span>
      </div>
      <div class="summary-card-body">
        <div class="summary-row">
          <span class="summary-label">íƒ€ê²ŸíŒ… ìœ í˜•</span>
          <span class="summary-value" id="summaryTargetType">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">ê¸°ê°„</span>
          <span class="summary-value" id="summaryRetention">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">ì œì™¸ ì¡°ê±´</span>
          <span class="summary-value" id="summaryExclusion">-</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´‘ê³  ë¬¸êµ¬ ìš”ì•½ -->
  <div class="summary-section">
    <div class="summary-card">
      <div class="summary-card-header">
        <div class="summary-card-title">
          <span class="summary-card-icon">âœï¸</span>
          <span>ê´‘ê³  ë¬¸êµ¬</span>
        </div>
        <span class="summary-card-edit" data-step="3">ìˆ˜ì •</span>
      </div>
      <div class="summary-card-body">
        <div class="summary-row">
          <span class="summary-label">í—¤ë“œë¼ì¸</span>
          <span class="summary-value" id="summaryHeadline">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">ì„¤ëª…</span>
          <span class="summary-value" id="summaryDescription">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">CTA ë²„íŠ¼</span>
          <span class="summary-value" id="summaryCta">-</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">ê´‘ê³  í˜•ì‹</span>
          <span class="summary-value" id="summaryFormat">-</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´‘ê³  ì„¸íŠ¸ ì´ë¦„ -->
  <div class="adset-name-section">
    <label class="input-label">ê´‘ê³  ì„¸íŠ¸ ì´ë¦„</label>
    <input type="text" class="text-input" id="adsetNameInput" placeholder="ì˜ˆ: ì¹´íƒˆë¡œê·¸_ë¦¬íƒ€ê²ŸíŒ…_14ì¼">
  </div>

  <!-- ì˜ˆì‚° ì„¤ì • -->
  <div class="budget-section">
    <label class="input-label">ì¼ì¼ ì˜ˆì‚°</label>
    <div class="budget-tabs">
      <div class="budget-tab active" data-type="daily">
        <span class="budget-tab-text">ì¼ì¼ ì˜ˆì‚°</span>
      </div>
      <div class="budget-tab" data-type="lifetime">
        <span class="budget-tab-text">ì´ ì˜ˆì‚°</span>
      </div>
    </div>
    <div class="budget-input-group">
      <span class="budget-currency">â‚©</span>
      <input type="number" class="budget-input" id="budgetInput" value="10000" min="1000" step="1000">
      <span class="budget-currency">/ì¼</span>
    </div>
    <div class="budget-hint">ìµœì†Œ â‚©1,000 ì´ìƒ ì„¤ì • ê°€ëŠ¥í•©ë‹ˆë‹¤</div>
  </div>
</div>

<!-- í•˜ë‹¨ ì•¡ì…˜ ë°” -->
<div class="admake-action-bar">
  <div class="admake-action-inner">
    <div class="admake-action-left font-inter">STEP 4 OF 4</div>
    <div class="admake-action-buttons">
      <button class="admake-btn admake-btn-secondary" id="prevBtn">ì´ì „</button>
      <button class="admake-btn admake-btn-primary" id="publishBtn">ê´‘ê³  ìƒì„±</button>
    </div>
  </div>
</div>

<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <div class="loading-text">ê´‘ê³ ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
  </div>
</div>

<!-- ì„±ê³µ í™”ë©´ -->
<div class="success-screen" id="successScreen">
  <div class="success-content">
    <div class="success-icon">
      <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
    </div>
    <div class="success-title">ê´‘ê³ ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    <div class="success-desc">
      ê´‘ê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
      Meta ê´‘ê³  ê´€ë¦¬ìì—ì„œ ê²€í†  í›„ í™œì„±í™”í•˜ì„¸ìš”.
    </div>
    <div class="success-id" id="successAdsetId">-</div>
    <button class="success-btn" id="successBtn">ê´‘ê³  ê´€ë¦¬ í˜ì´ì§€ë¡œ</button>
  </div>
</div>

<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/common_ui.js') }}"></script>

<script>
$(document).ready(function() {
    // ëª¨ë“  ìŠ¤í… ë°ì´í„° ë¡œë“œ
    const step1Data = JSON.parse(sessionStorage.getItem('catalogAdStep1') || '{}');
    const step2Data = JSON.parse(sessionStorage.getItem('catalogAdStep2') || '{}');
    const step3Data = JSON.parse(sessionStorage.getItem('catalogAdStep3') || '{}');

    // ë°ì´í„° ê²€ì¦
    if (!step1Data.selectedSetId && !step1Data.isNewSet) {
        window.location.href = "/admake/catalog/step1?account_id=" + encodeURIComponent(accountId);
        return;
    }

    // íƒ€ê²ŸíŒ… ìœ í˜• í…ìŠ¤íŠ¸ ë§¤í•‘
    const targetTypeMap = {
        'retarget_view_cart': 'ì¡°íšŒ/ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤',
        'retarget_cart': 'ì¥ë°”êµ¬ë‹ˆ â†’ ë¯¸êµ¬ë§¤',
        'upsell': 'ì—…ì…€ / í¬ë¡œìŠ¤ì…€',
        'broad': 'ê´‘ë²”ìœ„ íƒ€ê²ŸíŒ…'
    };

    // CTA í…ìŠ¤íŠ¸ ë§¤í•‘
    const ctaTextMap = {
        'SHOP_NOW': 'ì§€ê¸ˆ ì‡¼í•‘í•˜ê¸°',
        'LEARN_MORE': 'ë” ì•Œì•„ë³´ê¸°',
        'SEE_MORE': 'ë” ë³´ê¸°',
        'BUY_NOW': 'ì§€ê¸ˆ êµ¬ë§¤',
        'GET_OFFER': 'í˜œíƒ ë°›ê¸°',
        'ORDER_NOW': 'ì§€ê¸ˆ ì£¼ë¬¸'
    };

    // ìš”ì•½ í‘œì‹œ
    $("#summaryProductSet").text(step1Data.selectedSetName || step1Data.newSetName || '-');
    $("#summaryTargetType").text(targetTypeMap[step2Data.targetingType] || '-');
    $("#summaryRetention").text(step2Data.retentionDays ? `ìµœê·¼ ${step2Data.retentionDays}ì¼` : '-');
    $("#summaryExclusion").text(step2Data.excludePurchase ? 'êµ¬ë§¤ì ì œì™¸' : 'ì—†ìŒ');
    $("#summaryHeadline").text(step3Data.headline || '-');
    $("#summaryDescription").text(step3Data.description || '-');
    $("#summaryCta").text(ctaTextMap[step3Data.ctaType] || '-');
    $("#summaryFormat").text(step3Data.adFormat === 'carousel' ? 'ìŠ¬ë¼ì´ë“œ' : 'ë‹¨ì¼ ì´ë¯¸ì§€');

    // ê¸°ë³¸ ê´‘ê³  ì„¸íŠ¸ ì´ë¦„ ìƒì„±
    const defaultAdsetName = `ì¹´íƒˆë¡œê·¸_${targetTypeMap[step2Data.targetingType] || 'ë¦¬íƒ€ê²ŸíŒ…'}_${step2Data.retentionDays || 14}ì¼`;
    $("#adsetNameInput").val(defaultAdsetName);

    // ì˜ˆì‚° íƒ€ì… ì „í™˜
    let budgetType = 'daily';
    $(".budget-tab").on("click", function() {
        $(".budget-tab").removeClass("active");
        $(this).addClass("active");
        budgetType = $(this).data("type");

        if (budgetType === 'daily') {
            $(".budget-currency:last").text("/ì¼");
        } else {
            $(".budget-currency:last").text("(ì´)");
        }
    });

    // ìˆ˜ì • ë²„íŠ¼
    $(".summary-card-edit").on("click", function() {
        const step = $(this).data("step");
        window.location.href = `/admake/catalog/step${step}?account_id=` + encodeURIComponent(accountId);
    });

    // ì´ì „ ë²„íŠ¼
    $("#prevBtn").on("click", function() {
        window.location.href = "/admake/catalog/step3?account_id=" + encodeURIComponent(accountId);
    });

    // ê´‘ê³  ìƒì„± ë²„íŠ¼
    $("#publishBtn").on("click", function() {
        const adsetName = $("#adsetNameInput").val().trim();
        const budget = parseInt($("#budgetInput").val()) || 10000;

        if (!adsetName) {
            alert("ê´‘ê³  ì„¸íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        if (budget < 1000) {
            alert("ì˜ˆì‚°ì€ ìµœì†Œ 1,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        // ë¡œë”© í‘œì‹œ
        $("#loadingOverlay").addClass("active");

        // API í˜¸ì¶œ
        $.ajax({
            url: "/dashboard/catalog_ad/create",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                account_id: accountId,
                product_set_id: step1Data.selectedSetId,
                product_set_name: step1Data.selectedSetName,
                is_new_set: step1Data.isNewSet,
                auto_set_period: step1Data.autoSetPeriod,
                new_set_name: step1Data.newSetName,
                catalog_id: step1Data.catalogId,
                targeting_type: step2Data.targetingType,
                retention_days: step2Data.retentionDays,
                exclude_purchase: step2Data.excludePurchase,
                message: step3Data.message,
                headline: step3Data.headline,
                description: step3Data.description,
                cta_type: step3Data.ctaType,
                ad_format: step3Data.adFormat,
                adset_name: adsetName,
                budget: budget,
                budget_type: budgetType
            }),
            success: function(response) {
                $("#loadingOverlay").removeClass("active");

                if (response.status === "success") {
                    // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬
                    sessionStorage.removeItem('catalogAdStep1');
                    sessionStorage.removeItem('catalogAdStep2');
                    sessionStorage.removeItem('catalogAdStep3');

                    // ì„±ê³µ í™”ë©´ í‘œì‹œ
                    $("#successAdsetId").text(`Ad Set ID: ${response.adset_id || '-'}`);
                    $("#successScreen").addClass("active");
                } else {
                    alert("ì˜¤ë¥˜: " + (response.message || "ê´‘ê³  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."));
                }
            },
            error: function(xhr) {
                $("#loadingOverlay").removeClass("active");
                const errMsg = xhr.responseJSON?.message || "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                alert("ì˜¤ë¥˜: " + errMsg);
            }
        });
    });

    // ì„±ê³µ í™”ë©´ ë²„íŠ¼
    $("#successBtn").on("click", function() {
        window.location.href = "/ads?account_id=" + encodeURIComponent(accountId);
    });
});
</script>

</body>
</html>
